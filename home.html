    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Home | ArchiveHubs</title>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/insight-analysis.css">
        <link rel="stylesheet" href="css/general-terms.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    </head>
    <body>

        <nav class="navbar">
          <div class="nav-left">
              <a href="home.html" class="logo">
                <img src="images/Logo.jpg" alt="ArchiveHubs Logo" class="logo-img">
              </a>
              <div class="search-box">
                <div class="search-trigger">
                  <i class="fas fa-search search-icon"></i>
                  <div class="search-text">Search</div>
                </div>
                <input type="text" placeholder="Search..." class="search-input">
              </div>
          </div>
              
      <div class="nav-middle">
          <a href="home.html" class="nav-link">
              <i class="fas fa-home"></i>
              <span>Home</span>
          </a>
          <a href="./Archivehubs-Connections/myconnections.html" class="nav-link">
              <i class="fas fa-user-friends"></i>
              <span>MyConnections</span>
          </a>
          <a href="./Archivehubs-Video/video1.html" class="nav-link">
              <i class="fas fa-video"></i>
              <span>Video</span>
          </a>
          <a href="./Archivehubs-Message/messaging_page.html" class="nav-link">
              <i class="fas fa-comment-dots"></i>
              <span>Messages</span>
          </a>
          <a href="./Archivehubs-Notifications/notification.html" class="nav-link">
              <i class="fas fa-bell"></i>
              <span>Notifications</span>
          </a>
          <a href="#" class="nav-link profile-nav-link" id="accountPopup">
            <i class="fas fa-user-circle"></i>
            <span>Account</span>
          </a>
        </div>

              <div class="nav-right">

                <a href="./Archivehubs-Jobs/jobs.html" class="nav-link">
                  <i class="fas fa-briefcase"></i>
                  <span>Jobs</span>
                </a>
                <a href="./Archivehubs-Business/business.html" class="nav-link">
                    <i class="fas fa-building"></i>
                    <span>Business</span>
                </a>
                <a href="./Archivehubs-Drive/drive.html" class="nav-link">
                    <i class="fas fa-cloud-arrow-up"></i>
                    <span>Drive</span>
                </a>
                <a href="./Archivehubs-Menu/menu.html" class="nav-link">
                    <i class="fas fa-bars"></i>
                    <span>Menu</span>
                </a>
            </div>
          </nav>

          <!-- Replace your existing mobile-upper-nav section -->
          <div class="mobile-header">
            <!-- Mobile Upper Nav -->
            <nav class="mobile-upper-nav">
              <a href="home.html" class="mobile-logo">
                  <img src="images/Logo.jpg" alt="ArchiveHubs Logo">
              </a>
              <div class="upper-nav-right">
                  <button class="upper-nav-btn">
                      <i class="fas fa-plus"></i>
                  </button>
                  <button class="upper-nav-btn" id="searchTriggerBtn">
                      <i class="fas fa-search"></i>
                  </button>
                  <button class="upper-nav-btn">
                      <i class="fas fa-ellipsis-v"></i>
                  </button>
                </div>
            </nav>

           <!-- Update the search-view to be a dropdown -->
          <div class="search-overlay" id="searchView">
              <div class="search-container">
                  <div class="search-header">
                      <button class="back-btn" id="searchBackBtn">
                          <i class="fas fa-arrow-left"></i>
                      </button>
                      <div class="search-bar">
                          <div class="search-input-wrapper">
                              <img src="images/meta-ai-icon.png" alt="Meta AI" class="meta-ai-icon">
                              <input type="text" id="searchInput" placeholder="Ask Meta AI or search">
                          </div>
                      </div>
                  </div>

                  <div class="search-content">
                      <!-- Rest of your search content remains the same -->
                  </div>
              </div>
          </div>

          <!-- Add this after the existing navbar -->
        <nav class="mobile-top-nav">
          <a href="#" class="mobile-nav-item">
              <i class="fas fa-video"></i>
          </a>
          <a href="#" class="mobile-nav-item">
              <i class="fas fa-briefcase"></i>
          </a>
          <a href="business.html" class="mobile-nav-item">
              <i class="fas fa-building"></i>
          </a>
          <a href="#" class="mobile-nav-item">
              <i class="fas fa-cloud-arrow-up"></i>
          </a>
          <a href="#" class="mobile-nav-item">
              <i class="fas fa-user-circle"></i>
          </a>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
          <!-- Left Sidebar -->
          <section class="left-sidebar">
            <div class="profile-card">
              <div class="profile-header">
                <div class="profile-bg">
                  <img src="images/profile.jpg" alt="Cover Photo" class="cover-photo">
                </div>
                <div class="profile-info">
                  <a href="Archivehubs-Individual_Page/Individual_Bio_profile.html"><img src="images/profile.jpg" alt="Picture" class="profile-pic"></a>
                  <h2>John Doe</h2>
                  <p class="profile-bio">Softtware Developer | AI Enthusiast | Full stack Developer | Open Source Contributor</p>
                  <div class="profile-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Lagos, Nigeria</span>
                  </div>
                </div>
              </div>
              <div class="profile-analytics">

                <a href="#">
                  <div class="stat-item"> 
                    <span>Profile Visitors</span>
                  </div>
                </a>

                <a href="./insights_analysis/insight-analysis.html">
                  <div class="stat-item">
                    <span>Insight and Analysis</span>
                  </div>
                </a>

                <a href="./archive_explorer/archive_explorer.html">
                  <div class="stat-item">
                    <span>Archivehubs Explorer</span>
                  </div>
                </a>

                <a href="./Archivehubs_lite/archive_lite.html">
                  <div class="stat-item">
                    <span>Archivehubs Lite</span>
                  </div>
                </a>

                <a href="./Archivehubs_Learning/archive_learning_1.html">
                  <div class="stat-item">
                    <span>Archivehubs Learning</span>
                  </div>
                </a>

              </div>
            </div>

            <div class="quick-links">
              <a href="./PlannerAPS/planner-aps.html">
              <div class="link-item">
                <i class="fa-regular fa-calendar"></i>
                <span>Planner (APS)</span>
              </div>
              </a>
              <a href="./Archivehubs-Community/archive_community.html">
                <div class="link-item">
                  <img src="images/community-logo.jpeg" alt="Archive Community" class="link-icon">
                  <span>Archivehubs Community</span>
                </div>
              </a>
              <a href="./PlannerAPS/groups.html">
                <div class="link-item">
                <i class="fa-solid fa-user-group"></i>
                <span>Groups</span>
              </div>
              <a href="./Archivehubs-Newsletter/archive_newsletter.html">
              <div class="link-item">
                <i class="fa-regular fa-newspaper"></i>
                <span>Newsletters</span>
              </div>
              </a>
              <a href="./Archivehubs-Articles/Archive_article.html">
              <div class="link-item">
                <i class="fa-solid fa-pen"></i>
                <span>Write Articles</span>
              </div>
              </a>
            </div>
            <div class="general-terms">
              <a href="./General-Terms/general-terms.html" class="terms-link">General Terms</a>
          </div>
          </section>

          <!-- Middle Section -->
          <section class="middle-section">
            <!-- Post Creation Area -->
            <div class="create-post">
              <div class="company-header">
                <img src="images/company-chat.jpg" alt="ArchiveHubs" class="company-logo">
              </div>
              <div class="post-input-container">
                <a href="Archivehubs-Individual_Page/Individual_Bio_profile.html"><img src="images/profile.jpg" alt="User Profile" class="user-profile-pic"></a>
                <a href="./Archivehubs-Create-Post/create_post.html">
                  <div class="post-input-wrapper">
                    <input type="text" placeholder="Start a post" class="post-input">
                  </div>
                </a>
              </div>
              
              <!-- Post Actions -->
              <div class="post-actions">
              <a href="./Archivehubs-Video/video2-live.html">
                <button class="action-btn">
                  <i class="fas fa-video"></i>
                  <span>Live Video</span>
                </button>
              </a>
                <a href="./Archivehubs-Media/media.html">
                  <button class="action-btn">
                    <i class="fas fa-image"></i>
                    <span>Media</span>
                  </button>
                </a>
                <a href="./Archivehubs-Games/gamespage.html">
                  <button class="action-btn">
                  <i class="fas fa-gamepad"></i>
                  <span>Game</span>
                </button>
                </a>
                <button class="action-btn">
                  <i class="fas fa-robot"></i>
                  <span>AI</span>
                </button>
              </div>
            </div>
            

                  <!-- After create-post div -->
          <div class="stories-section">
            <div class="stories-container">

              <!-- Create Story Card -->
              <div class="story-card create-story">
                <div class="story-content">
                  <div class="create-story-top" onclick="window.location.href='./Archivehubs-Create-Story/story.html'">
                    <img src="images/profile.jpg" alt="Your Profile" class="story-avatar">
                    <label for="story-upload" class="create-story-plus">
                      <i class="fas fa-plus"></i>
                    </label>
                    <input type="file" id="story-upload" class="file-input" accept="image/*,video/*">
                    <span class="story-username">Create Story</span>
                  </div>
                </div>
              </div>
              <!-- Story Cards - 6 cards as shown in mockup -->
              <div class="story-card">
                <div class="story-content">
                  <img src="images/profile.jpg" alt="User" class="story-avatar">
                  <span class="story-username">John Doe</span>
                </div>
              </div>
              <!-- Repeat story-card div 5 more times for other stories -->
              <div class="story-card">
                <div class="story-content">
                  <img src="images/profile.jpg" alt="User" class="story-avatar">
                  <span class="story-username">John Doe</span>
                </div>
              </div>
              <div class="story-card">
                <div class="story-content">
                  <img src="images/profile.jpg" alt="User" class="story-avatar">
                  <span class="story-username">John Doe</span>
                </div>
              </div>
              <div class="story-card">
                <div class="story-content">
                  <img src="images/profile.jpg" alt="User" class="story-avatar">
                  <span class="story-username">John Doe</span>
                </div>
              </div>
              <div class="story-card">
                <div class="story-content">
                  <img src="images/profile.jpg" alt="User" class="story-avatar">
                  <span class="story-username">John Doe</span>
                </div>
              </div>
              <div class="story-card">
                <div class="story-content">
                  <img src="images/profile.jpg" alt="User" class="story-avatar">
                  <span class="story-username">John Doe</span>
                </div>
              </div>
              <div class="story-card">
                <div class="story-content">
                  <img src="images/profile.jpg" alt="User" class="story-avatar">
                  <span class="story-username">John Doe</span>
                </div>
              </div>
              <!-- ... more story cards ... -->
            </div>
          </div>

          <!-- Posts Section -->
          <div class="posts-section">
            <div class="post" data-post-id="1">
              <!-- Post Header -->
              <div class="post-header">
                <div class="post-author-info">
                    <a href="Archivehubs-Individual_Page/Individual_Bio_profile.html"><img src="images/profile.jpg" alt="Profile" class="post-profile-pic"></a>
                    <div class="post-author-details">
                        <h4 class="post-author-name">Sarah Johnson</h4>
                        <p class="post-meta">Software Engineer at Tech Corp ‚Ä¢ 2h ago</p>
                    </div>
                </div>
              </div>

              <!-- Post Content -->
              <div class="post-content">
                <p class="post-text">
                  Just finished implementing a new feature using AI! Really excited about how machine learning 
                  is transforming the way we build software. What are your thoughts on AI in modern development? 
                  #Programming #AI #Innovation
                </p>
                <!-- Optional: Add post image if needed -->
                <img src="images/post-example.jpg" alt="Post Image" class="post-image">
              </div>

              <!-- Post Metrics -->
              <div class="post-metrics">
                <span class="metric">
                  <i class="fas fa-thumbs-up"></i>
                  <span class="metric-count" data-likes="142">142</span>
                </span>
                <span class="metric">
                  <span class="metric-count comment-trigger" data-comments="28">28 comments</span>
                </span>
              </div>

              <!-- Post Actions -->
              <div class="post-actions">
                <button class="action-btn like-btn" data-post-id="1" data-liked="false">
                  <i class="far fa-thumbs-up"></i>
                  <span>Like</span>
                </button>
                <button class="action-btn">
                  <i class="far fa-comment"></i>
                  <span>Comment</span>
                </button>
                <div class="repostWrapper" style="position:relative;display:inline-block;">
                  <button class="action-btn repost-btn" id="repost-btn-1">
                    <i class="fas fa-retweet"></i>
                    <span>Repost</span>
                  </button>
                  <!--repost option-->
                  <div class="repost-expanded" id="repost-expanded-1" style="display:none; position:absolute; left:0; top:40px; background:#fff; border:1px solid #e5e7eb; border-radius:10px; box-shadow:0 12px 28px rgba(0,0,0,.2); width:320px; z-index:10000; overflow:hidden;">
                    <button id="thoughtRepost-btn-1" class="thoughtRepost-btn repost-option-btn" style="display:block;width:100%;text-align:left;background:transparent;border:0;cursor:pointer;padding:12px 14px;">
                      <span class="material-symbols-outlined" style="vertical-align:middle;margin-right:10px;font-size:20px;color:#111827">edit_square</span> <strong style="font-weight:600;color:#111827">Repost with your thoughts</strong>
                      <p style="margin:4px 0 0 30px;font-size:12px;color:#6b7280">Create a new post with thoughts</p>
                    </button>
                    <hr style="margin:0;border:0;border-top:1px solid #e5e7eb">
                    <button id="plainRepost-1" class="repost-option-btn" style="display:block;width:100%;text-align:left;background:transparent;border:0;cursor:pointer;padding:12px 14px;">
                      <span class="material-symbols-outlined" style="vertical-align:middle;margin-right:10px;font-size:20px;color:#111827">repeat</span> <strong style="font-weight:600;color:#111827">Repost</strong>
                      <p style="margin:4px 0 0 30px;font-size:12px;color:#6b7280">Instantly bring this post to others feeds</p>
                    </button>
                  </div>
                </div>
                <button class="action-btn" id="share-btn-1">
                  <i class="far fa-paper-plane"></i>
                  <span>Share</span>
                </button>
              </div>
            </div>

            <!-- Second Post -->
            <div class="post" data-post-id="2">
              <!-- Post Header -->
              <div class="post-header">
                <div class="post-author-info">
                    <a href="Archivehubs-Individual_Page/Individual Bio Page Profile/index.html"><img src="images/profile.jpg" alt="Profile" class="post-profile-pic"></a>
                    <div class="post-author-details">
                        <h4 class="post-author-name">Michael Chen</h4>
                        <p class="post-meta">Product Manager at ArchiveHubs ‚Ä¢ 4h ago</p>
                    </div>
                </div>
              </div>

              <!-- Post Content -->
              <div class="post-content">
                <p class="post-text">
                  Excited to announce our new ArchiveHubs platform! We're revolutionizing how businesses 
                  manage their digital assets and archives. Looking forward to your feedback! üöÄ
                  #ArchiveHubs #DigitalAssets #Innovation
                </p>
              </div>

              <!-- Post Metrics -->
              <div class="post-metrics">
                <span class="metric">
                  <i class="fas fa-thumbs-up"></i>
                  <span class="metric-count" data-likes="89">89</span>
                </span>
                <span class="metric">
                  <span class="metric-count comment-trigger" data-comments="15">15 comments</span>
                </span>
              </div>

              <!-- Post Actions -->
              <div class="post-actions">
                <button class="action-btn like-btn" data-post-id="2" data-liked="false">
                  <i class="far fa-thumbs-up"></i>
                  <span>Like</span>
                </button>
                <button class="action-btn">
                  <i class="far fa-comment"></i>
                  <span>Comment</span>
                </button>
                <button class="action-btn repost-btn">
                  <i class="fas fa-retweet"></i>
                  <span>Repost</span>
                </button>
                <button class="action-btn">
                  <i class="far fa-paper-plane"></i>
                  <span>Share</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Comment Modal -->
          <div id="commentModal" class="comment-modal">
            <div class="comment-modal-content">
              <div class="comment-modal-header">
                <h3>Comments</h3>
                <button class="close-modal-btn">&times;</button>
              </div>
              
              <div class="comment-filters">
                <button class="filter-btn active" data-filter="relevant">Most Relevant</button>
                <button class="filter-btn" data-filter="newest">Newest</button>
                <button class="filter-btn" data-filter="all">All Comments</button>
              </div>
              
              <div class="post-preview">
                <!-- Post content will be dynamically inserted here -->
              </div>
              
              <div class="comments-container">
                <!-- Comments will be dynamically loaded here -->
              </div>
              
              <div class="add-comment-section">
                <img src="images/profile.jpg" alt="Profile" class="comment-profile-pic">
                <div class="comment-input-container">
                  <textarea class="comment-input" placeholder="Write a comment..."></textarea>
                  <button class="post-comment-btn">Post</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Add this after the posts-section -->
          <div class="connections-section">
            <div class="connections-header">
                <h3>Connections you may want</h3>
                <button class="see-all-btn">See All</button>
            </div>
            
            <div class="connections-container">
                <!-- Connection Cards -->
                <div class="connection-card">
                    <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                    <div class="connection-info">
                        <h4>David Chen</h4>
                        <p>Software Engineer at Google</p>
                    </div>
                    <div class="connection-actions">
                      <button class="connect-btn">Connect</button>
                      <button class="decline-btn">Decline</button>
                    </div>
                </div>

                <div class="connection-card">
                    <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                    <div class="connection-info">
                        <h4>Sarah Williams</h4>
                        <p>Data Scientist at Microsoft</p>
                    </div>
                    <div class="connection-actions">
                      <button class="connect-btn">Connect</button>
                      <button class="decline-btn">Decline</button>
                    </div>
                </div>

                <div class="connection-card">
                    <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                    <div class="connection-info">
                        <h4>Michael Rodriguez</h4>
                        <p>AI Researcher at OpenAI</p>
                    </div>
                    <div class="connection-actions">
                      <button class="connect-btn">Connect</button>
                      <button class="decline-btn">Decline</button>
                    </div>
                </div>

                <div class="connection-card">
                    <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                    <div class="connection-info">
                        <h4>Michael Rodriguez</h4>
                        <p>AI Researcher at OpenAI</p>
                    </div>
                    <div class="connection-actions">
                      <button class="connect-btn">Connect</button>
                      <button class="decline-btn">Decline</button>
                    </div>
                </div>

                <div class="connection-card">
                    <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                    <div class="connection-info">
                        <h4>Michael Rodriguez</h4>
                        <p>AI Researcher at OpenAI</p>
                    </div>
                    <div class="connection-actions">
                      <button class="connect-btn">Connect</button>
                      <button class="decline-btn">Decline</button>
                    </div>
                </div>

                <!-- Add more connection cards as needed -->
            </div>
          </div>

          <!-- Posts Section -->
                <div class="posts-section">
                  <div class="post" data-post-id="1">
                    <!-- Post Header -->
                    <div class="post-header">
                      <div class="post-author-info">
                          <img src="images/profile.jpg" alt="Profile" class="post-profile-pic">
                          <div class="post-author-details">
                              <h4 class="post-author-name">Michael Rodriguez</h4>
                              <p class="post-meta">Software Engineer at Meta ‚Ä¢ 30min ago</p>
                          </div>
                      </div>
                    </div>

                    <!-- Post Content -->
                    <div class="post-content">
                      <p class="post-text">
                        Rebuilding the next generation of technology with the new META Virtual Reality Devices. Can't wait for what the future holds #Innovation #Programming #MachineLearning
                      </p>
                      <!-- Optional: Add post image if needed -->
                      <img src="images/post-example2.jpg" alt="Post Image" class="post-image">
                    </div>

                    <!-- Post Metrics -->
                    <div class="post-metrics">
                      <span class="metric">
                        <i class="fas fa-thumbs-up"></i>
                        <span class="metric-count" data-likes="3000">3k</span>
                      </span>
                      <span class="metric">
                        <span class="metric-count">400 comments</span>
                      </span>
                    </div>

                    <!-- Post Actions -->
                    <div class="post-actions">
                      <button class="action-btn like-btn" data-post-id="1" data-liked="false">
                        <i class="far fa-thumbs-up"></i>
                        <span>Like</span>
                      </button>
                      <button class="action-btn">
                        <i class="far fa-comment"></i>
                        <span>Comment</span>
                      </button>
                      <button class="action-btn repost-btn">
                        <i class="fas fa-retweet"></i>
                        <span>Repost</span>
                      </button>
                      <button class="action-btn">
                        <i class="far fa-paper-plane"></i>
                        <span>Share</span>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Add this after the posts-section -->
                <div class="connections-section">
                  <div class="connections-header">
                      <h3>Connections Requests</h3>
                      <button class="see-all-btn">See All</button>
                  </div>
                  
                  <div class="connections-container">
                      <!-- Connection Cards -->
                      <div class="connection-card">
                          <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                          <div class="connection-info">
                              <h4>David Chen</h4>
                              <p>Software Engineer at Google</p>
                          </div>
                          <div class="connection-actions">
                            <button class="connect-btn">Connect</button>
                            <button class="decline-btn">Decline</button>
                          </div>
                      </div>
          
                      <div class="connection-card">
                          <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                          <div class="connection-info">
                              <h4>Sarah Williams</h4>
                              <p>Data Scientist at Microsoft</p>
                          </div>
                          <div class="connection-actions">
                            <button class="connect-btn">Connect</button>
                            <button class="decline-btn">Decline</button>
                          </div>
                      </div>
          
                      <div class="connection-card">
                          <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                          <div class="connection-info">
                              <h4>Michael Rodriguez</h4>
                              <p>AI Researcher at OpenAI</p>
                          </div>
                          <div class="connection-actions">
                            <button class="connect-btn">Connect</button>
                            <button class="decline-btn">Decline</button>
                          </div>
                      </div>
          
                      <div class="connection-card">
                          <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                          <div class="connection-info">
                              <h4>Michael Rodriguez</h4>
                              <p>AI Researcher at OpenAI</p>
                          </div>
                          <div class="connection-actions">
                            <button class="connect-btn">Connect</button>
                            <button class="decline-btn">Decline</button>
                          </div>
                      </div>
          
                      <div class="connection-card">
                          <img src="images/profile.jpg" alt="Profile" class="connection-avatar">
                          <div class="connection-info">
                              <h4>Michael Rodriguez</h4>
                              <p>AI Researcher at OpenAI</p>
                          </div>
                          <div class="connection-actions">
                            <button class="connect-btn">Connect</button>
                            <button class="decline-btn">Decline</button>
                          </div>
                      </div>
          
                      <!-- Add more connection cards as needed -->
                  </div>
                </div>

                            <!-- Business Page Post Section -->
                <div class="business-post-section">
                  <!-- Post Header -->
                  <div class="post-header">
                      <div class="post-author-info">
                          <img src="images/profile.jpg" alt="Tesla" class="post-profile-pic">
                          <div class="post-author-details">
                              <h4 class="post-author-name">Tesla Motors</h4>
                              <p class="post-meta">
                                  Sponsored ‚Ä¢ <i class="fas fa-globe-americas"></i>
                              </p>
                          </div>
                      </div>
                      <button class="more-options">
                          <i class="fas fa-ellipsis-h"></i>
                      </button>
                  </div>

                  <!-- Post Content -->
                  <div class="post-content">
                      <p>Introducing the next generation of electric vehicles. Experience the future of sustainable transportation. 
                        #Tesla #Innovation #Sustainability</p>
                      <img src="images/tesla-post.jpg" alt="Tesla Car" class="post-image">
                  </div>

                  <!-- Post Metrics -->
                  <div class="post-metrics">
                      <div class="metrics-left">
                          <span class="metric">
                              <i class="fas fa-thumbs-up"></i>
                              <span class="metric-count">15.4K</span>
                          </span>
                      </div>
                      <div class="metrics-right">
                          <span class="metric">2.8K comments</span>
                          <span class="metric-dot">‚Ä¢</span>
                          <span class="metric">4.2K shares</span>
                          <span class="metric-dot">‚Ä¢</span>
                          <span class="metric">1.6K reposts</span>
                      </div>
                  </div>

                  <!-- Post Actions -->
                  <div class="post-actions">
                      <button class="action-btn">
                          <i class="far fa-thumbs-up"></i>
                          <span>Like</span>
                      </button>
                      <button class="action-btn">
                          <i class="far fa-comment"></i>
                          <span>Comment</span>
                      </button>
                      <button class="action-btn repost-btn">
                        <i class="fas fa-retweet"></i>
                        <span>Repost</span>
                    </button>
                      <button class="action-btn">
                          <i class="fas fa-paper-plane"></i>
                          <span>Share</span>
                      </button>
                  </div>
                </div>

          </section>

                  <!-- Right Sidebar -->
            <div class="right-sidebar">
              <!-- Network Section -->
              <div class="sidebar-section">
                <div class="section-header">
                  <h3 class="section-title">Add to your network</h3>
                  <a href="#" class="see-all">See all</a>
                </div>
                  
                  <!-- Connection Suggestions -->
                  <div class="connection-suggestions">
                          <div class="suggestion-item">
                            <div class="suggestion-header">
                              <img src="images/profile.jpg" alt="Profile" class="suggestion-avatar">
                              <div class="suggestion-info">
                                <h4>Emma Watson</h4>
                                <p>Senior UI/UX Designer at Apple</p>
                              </div>
                            </div>
                            <div class="suggestion-actions">
                              <button class="connect-btn">Connect</button>
                              <button class="decline-btn">Decline</button>
                            </div>
                          </div>

                      <div class="suggestion-item">
                          <div class="suggestion-header">
                              <img src="images/profile.jpg" alt="Profile" class="suggestion-avatar">
                              <div class="suggestion-info">
                                  <h4>James Rodriguez</h4>
                                  <p>Backend Developer at Microsoft</p>
                              </div>
                          </div>
                          <div class="suggestion-actions">
                              <button class="connect-btn">Connect</button>
                              <button class="decline-btn">Decline</button>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- Trending News Section -->
              <div class="sidebar-section">
                <div class="section-header">
                  <h3 class="section-title">Trending News</h3>
                  <a href="#" class="see-all">See all</a>
                </div>
                  
                  <div class="trending-news">
                      <div class="news-item">
                          <img src="images/profile.jpg" alt="News" class="news-image">
                          <div class="news-content">
                              <span class="news-source">TechCrunch ‚Ä¢ 2h ago</span>
                              <h4>AI Breakthrough: New Model Surpasses Human Performance</h4>
                          </div>
                      </div>

                      <div class="news-item">
                          <img src="images/profile.jpg" alt="News" class="news-image">
                          <div class="news-content">
                              <span class="news-source">Bloomberg ‚Ä¢ 4h ago</span>
                              <h4>Global Markets See Record High in Tech Sector</h4>
                          </div>
                      </div>

                      <div class="news-item">
                          <img src="images/profile.jpg" alt="News" class="news-image">
                          <div class="news-content">
                              <span class="news-source">Forbes ‚Ä¢ 6h ago</span>
                              <h4>Top 10 Startups to Watch in 2024</h4>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- Pages Suggestions -->
              <div class="sidebar-section">
                <div class="section-header">
                  <h3 class="section-title">Suggested Pages</h3>
                  <a href="#" class="see-all">See all</a>
                </div>
                  
                  <div class="page-suggestions">
                      <div class="page-item">
                          <img src="images/profile.jpg" alt="Page" class="page-image">
                          <div class="page-info">
                              <h4>Tesla Motors</h4>
                              <p>Automotive Company ‚Ä¢ 2.5M followers</p>
                          </div>
                          <button class="follow-btn">Follow</button>
                      </div>

                      <div class="page-item">
                          <img src="images/profile.jpg" alt="Page" class="page-image">
                          <div class="page-info">
                              <h4>Google</h4>
                              <p>Technology Company ‚Ä¢ 5.8M followers</p>
                          </div>
                          <button class="follow-btn">Follow</button>
                      </div>

                      <div class="page-item">
                          <img src="images/profile.jpg" alt="Page" class="page-image">
                          <div class="page-info">
                              <h4>NASA</h4>
                              <p>Space Agency ‚Ä¢ 4.2M followers</p>
                          </div>
                          <button class="follow-btn">Follow</button>
                      </div>
                  </div>
              </div>

              <div class="app-promotion">
                <h3>Get the Archive App</h3>
                <img src="images/hubs.jpg" alt="ArchiveHubs App" class="app-banner">
                <div class="copyright">
                    <p>ENINK Investment Limited ¬© 2025</p>
                    <img src="images/company-name.jpg" alt="Company Logo" class="company-logo">
                </div>
              </div>
            </div>

            <!-- Mobile Bottom Navigation -->
          <nav class="mobile-nav">
            <a href="#" class="mobile-nav-link active">
                <i class="fas fa-home"></i>
            </a>
            <a href="business.html" class="mobile-nav-link">
                <i class="fas fa-user-friends"></i>
            </a>
            <a href="#" class="mobile-nav-link">
                <i class="fas fa-comment-dots"></i>
            </a>
            <a href="#" class="mobile-nav-link">
                <i class="fas fa-bell"></i>
            </a>
            <a href="account-mobile.html" class="mobile-nav-link">
                <i class="fas fa-bars"></i>
            </a>
          </nav>

              <!-- Messaging Box -->
              <div class="messageWidget-container">

        
                <div class="chatThread-container hidden" id="chatThread-container">
                    <div class="chatThread-header">
                        <img src="Images/profile.jpg" alt="Contact Profile Picture" id="threadContactPicture">
                        <span class="threadContactName" id="threadContactName"></span>
        
                        <div class="chatThread-headerBtns">
                            <div class="chatThread-headerDropdown">
                                <button class="control" id="chatHeader-dropdownInitializer">
                                <span class="material-symbols-outlined">more_horiz</span>
                                </button>
                                <div class="chatHeader-dropdownMenu hidden" id="chatHeader-dropdownMenu">
                                    <button class="chatDropdown-item"><span>Move to others</span></button>
                                    <button class="chatDropdown-item"><span>Label as jobs</span></button>
                                    <button class="chatDropdown-item"><span>Mark as Unread</span></button>
                                    <button class="chatDropdown-item"><span>Star</span></button>
                                    <button class="chatDropdown-item"><span>Mute</span></button>
                                    <button class="chatDropdown-item"><span>Archive</span></button>
                                    <button class="chatDropdown-item"><span>Report/Block</span></button>
                                    <button class="chatDropdown-item"><span>Delete Conversation</span></button>
                                    <button class="chatDropdown-item"><span>Manage Settings</span></button>
                                </div>
                            </div>
        
                            <button class="control">
                                <span class="material-symbols-outlined"><span class="material-symbols-outlined">
                                    close_fullscreen
                                    </span></span>
                            </button>
        
                            <button id="backToChatList-btn" class="control">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                            
                        </div>
                        
                    </div>
        
                    <div class="chatThread-messages" id="chatThread-messages">
                        <div class="no-messages-yet">
                           Start a conversation! 
                        </div>
                    </div>
        
                    <div class="chatThread-composer">
                        <div class="messageInput" id="messageInput" contenteditable="true"></div>
                        <div class="chatComposer-menus">
                            <div class="chatComposer-menuItem">
                                <button class="menuItem-btn" id="attachImage-btn">
                                    <span class="material-symbols-outlined">image</span>
                                </button>
                                <button class="menuItem-btn" id="attachFile-btn">
                                    <span class="material-symbols-outlined">attach_file</span>
                                </button>
                                <button class="menuItem-btn" id="attachGif-btn">
                                    <span class="material-symbols-outlined">gif_box</span>
                                </button>
                                <div class="emojiWrapper">
                                    <button class="menuItem-btn" id="emoji-btn">
                                        <span class="material-symbols-outlined">insert_emoticon</span>
                                    </button>
                                    <div class="emojiPicker hidden" id="emojiPicker">
                                        <div class="emojiGrid">
                                            <button>üòä</button> <button>üòÇ</button> <button>üòç</button> <button>ü§£</button> <button>üò¢</button>
                                            <button>üòé</button> <button>üò°</button> <button>üò¥</button> <button>üòÖ</button> <button>üòá</button>
                                            <button>‚ù§Ô∏è</button> <button>üíõ</button> <button>üíö</button> <button>üíô</button> <button>üíú</button>
                                            <button>üñ§</button> <button>ü§ç</button> <button>ü§é</button> <button>üíî</button> <button>üíñ</button>
                                            <button>üëç</button> <button>üëé</button> <button>üëè</button> <button>üôè</button> <button>üëå</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
        
                            <input type="file" id="attachmentInput" class="hidden">
        
                            <button id="sendMessage-btn">
                                <span class="material-symbols-outlined">send</span>
                            </button>
                        </div>
                    </div>
                </div>
        
                <div class="messageList-panel">
                
                    <div class="messageWidget-wrapper">
                    <div class="messageWidget">
                    <img src="Images/profile.jpg" alt="User Profile Picture">
                    <p>Messaging</p>
                    <div class="messageWidget-controlsWrapper">
                        <div class="messageWidget-controls">
                            <button class="control" id="menuControl"><span class="material-symbols-outlined">more_horiz</span></button>
                            <button class="control"><span class="material-symbols-outlined">edit_square</span></button>
                            <button class="control" id="toggleWidget-btn"><span class="material-symbols-outlined" id="arrowIcon">keyboard_control_key</span></button>
                        </div>
                    </div>
                </div>
                <!--3 dot menu-->
                <div class="manageConversations-menuItems hidden" id="manageConversations-menuItems">
                    <button class="subControl" id="manageConversations">Manage Conversations</button>
                    <button class="subControl" id="messageSettings">Message Settings</button>
                    <button class="subControl" id="awayMessage">Set Away Message</button>
                </div>
                </div>
        
                <div class="messageWidget-extended">
        
                    <div class="searchWrapper">
                        <span class="material-symbols-outlined">search</span>
                        <input type="search" id="searchBar" placeholder="Search messages">
                    </div>
        
                    <div class="messageType-menu">
                        <div class="messageNavigation">
                            <button class="active" data-tab="focused" id="focusedTab">Focused</button>
                            <button data-tab="others" id="othersTab">Others</button>
                        </div>
        
                        <div class="messageType-content">
                            <div class="chatList active" id="focusedChats">
                                <!--chat items-->
                            </div>
        
                            <div class="chatList" id="otherChats">
                                <!--chat items-->
                            </div>
                        </div>
                    </div>
                </div>
        
                </div>
        
        
            </div>
        
            <!--set an away message-->
            <div class="modal hidden" id="awayModal">
                <div class="awayModal-content" id="awayModal-content">
                    <div class="awayModal-contentContainer">
                        <div class="awayModal-contentHeader" id="awayModal-contentHeader">
                            <p><img id="premium-img" src="Images/premium.png" alt="Diamond">PREMIUM</p>
                            <button class="cancel-btn" id="awayModal-cancelBtn">&times;</button>
                        </div>
                    </div>
                    <div class="awayModal-contentContainer">
                        <div class="awayModal-content1" id="awayModal-content1">
                            <h3>Set an away message</h3>
                            <p>With Premium, you can set away messages to inform your 
                                connections to expect a delayed response to their messages.
                            </p>
                            <div id="awayModal-content11">
                                <img src="Images/circle.png" alt="Name&others use premium">
                                <span>Name and other members use premium</span>
                            </div>
                        </div>
                    </div>
        
                    <div class="awayModal-contentContainer">
                        <div class="awayModal-content2" id="awayModal-content2">
                            <div id="awayModal-content21">
                                <div class="date">
                                    <label for="startDate">Start Date</label>
                                    <input type="date" id="startDate">
                                </div>
                                <div><img id="line-img" src="Images/line.png" alt="Long hyphen"></div>
                                <div class="date">
                                    <label for="startDate">End Date</label>
                                    <input type="date" id="endDate">
                                </div>
                            </div>
                            <div id="awayModal-content22">
                                <label for="awayMessenger">Message</label>
                                <div id="awayMessenger" contenteditable="true"></div>
                            </div>
                            <div id="wordCounter" style="text-align: right; font-size: 0.9em; color: gray; margin-top: 0;">
                                0/300
                            </div>
                        </div>
                    </div>
        
                    <div class="awayModal-contentContainer">
                        <div class="awayModal-content3" id="awayModal-content3">
                            <p>1-month free with 24/7 support. Cancel anytime. <br>
                                We'll remind you 7 days before your trial ends.
                            </p>
                            <button id="tryPremium-btn">Try Premium for NGN0.00</button>
                        </div>
                    </div>
        
                    <div class="awayModal-content4"><button id="awayMessage-btn">Set Message</button></div> 
                </div>
            </div>
        
            <!--Messaging settings-->
            <div class="modal hidden" id="messageSetting-modal">
                <div class="messageSetting-modalContent">
                    <div class="options">
                        <div class="messageSetting-modalHeader">
                            <h3>Messaging Setting</h3>
                            <button class="cancel-btn" id="cancelMessage-settingBtn">&times;</button>
                        </div>
                    </div>
                    <div class="options">
                        <p>
                            <span>Always Open New Messages</span> 
                            <label class="toggleSwitch">
                                <input type="checkbox" id="openNew-message">
                                <span class="slider"></span>
                            </label>
                        </p>
                    </div>
                    <div class="options">
                        <p>
                            <span>Play Sound for New Messages</span>
                            <label class="toggleSwitch">
                                <input type="checkbox" id="playMessage-sound">
                                <span class="slider"></span>
                            </label>
                        </p>
                    </div>
                    <div class="options"><p><span>Focused Inbox Settings</span> <button class="messageSetters" id="FocusedInbox-btn">Update Settings</button></p></div>
                    <div class="options"><p><span>Active Status Settings</span> <button class="messageSetters" id="ActiveStatus-btn">Update Settings</button></p></div>
                </div>
            </div>
</main>

    <!-- Share Modal (first post) -->
    <div id="shareModal1" style="display:none; position:fixed; inset:0; z-index:10000;">
      <div id="shareOverlay1" style="position:absolute; inset:0; background:rgba(0,0,0,.5);"></div>
      <div style="position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:540px; max-width:92vw; background:#fff; border-radius:10px; box-shadow:0 12px 28px rgba(0,0,0,.2); overflow:hidden;">
        <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #e5e7eb;">
          <div style="font-weight:600; font-size:16px; color:#111827;">Share</div>
          <button id="shareClose1" style="background:transparent; border:0; font-size:18px; cursor:pointer; color:#4b5563">√ó</button>
        </div>
        <div style="padding:14px 16px;">
          <div style="font-weight:600; font-size:14px; color:#111827; margin-bottom:8px;">Send as Message:</div>
          <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:18px; margin-bottom:14px;">
            <div style="text-align:center; color:#111827;">
              <div style="width:40px; height:40px; border-radius:9999px; border:1px solid #e5e7eb; margin:0 auto 6px; display:flex; align-items:center; justify-content:center; color:#6b7280;">üë§</div>
              <div style="font-size:12px;">Name1</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="width:40px; height:40px; border-radius:9999px; border:1px solid #e5e7eb; margin:0 auto 6px; display:flex; align-items:center; justify-content:center; color:#6b7280;">üë§</div>
              <div style="font-size:12px;">Name2</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="width:40px; height:40px; border-radius:9999px; border:1px solid #e5e7eb; margin:0 auto 6px; display:flex; align-items:center; justify-content:center; color:#6b7280;">üë§</div>
              <div style="font-size:12px;">Name3</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="width:40px; height:40px; border-radius:9999px; border:1px solid #e5e7eb; margin:0 auto 6px; display:flex; align-items:center; justify-content:center; color:#6b7280;">üë§</div>
              <div style="font-size:12px;">Name4</div>
            </div>
          </div>

          <div style="font-weight:600; font-size:14px; color:#111827; margin:10px 0 8px;">Share to:</div>
          <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:18px; margin-bottom:14px;">
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üìÅ</div>
              <div style="font-size:12px;">Drive</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üü°</div>
              <div style="font-size:12px;">Your Story</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üîó</div>
              <div style="font-size:12px;">Copy link</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üë•</div>
              <div style="font-size:12px;">Group</div>
            </div>
          </div>

          <div style="font-weight:600; font-size:14px; color:#111827; margin:10px 0 8px;">Share with:</div>
          <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:18px; margin-bottom:14px;">
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üîó</div>
              <div style="font-size:12px;">Copy link</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üü¢</div>
              <div style="font-size:12px;">Whatsapp</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üìò</div>
              <div style="font-size:12px;">Facebook</div>
            </div>
            <div style="text-align:center; color:#111827;">
              <div style="font-size:20px; margin-bottom:6px;">üì∏</div>
              <div style="font-size:12px;">Instagram</div>
            </div>
          </div>

          <div style="background:#f9fafb; border:1px solid #e5e7eb; border-radius:6px; padding:10px 12px; font-size:12px; color:#374151; margin-bottom:12px;">Links you share are unique to you and may be used to improve suggestions and ads you see. <a href="#" style="color:#1d4ed8; text-decoration:underline;">Learn More</a></div>

          <div style="display:flex; align-items:center; gap:10px; margin:10px 0;">
            <div style="width:36px; height:36px; border-radius:9999px; background:#e5e7eb; display:flex; align-items:center; justify-content:center;">üë§</div>
            <div>
              <div style="font-weight:600; color:#111827;">Name</div>
              <div style="font-size:12px; color:#6b7280; display:flex; align-items:center; gap:6px;">
                <span class="material-symbols-outlined" style="font-size:16px;">group</span>
                Connections <span style="font-size:12px;">‚ñæ</span>
              </div>
            </div>
          </div>

          <div>
            <textarea placeholder="Say something about this(Optional)" style="width:100%; min-height:72px; border:1px solid #e5e7eb; border-radius:8px; padding:10px 12px; font-family:inherit; resize:vertical;"></textarea>
          </div>
        </div>
        <div style="padding:12px 16px; border-top:1px solid #e5e7eb; display:flex; justify-content:flex-end;">
          <button id="shareNow1" style="background:#facc15; color:#111827; border:0; border-radius:9999px; padding:10px 16px; font-weight:600; cursor:pointer;">Share Now</button>
        </div>
      </div>
    </div>

    <!-- Repost With Thoughts Modal (first post) -->
    <div id="repostThoughtsModal1" style="display:none; position:fixed; inset:0; z-index:10000;">
      <div id="repostThoughtsOverlay1" style="position:absolute; inset:0; background:rgba(0,0,0,.5);"></div>
      <div style="position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:520px; max-width:90vw; max-height:85vh; background:#fff; border-radius:10px; box-shadow:0 12px 28px rgba(0,0,0,.2); overflow:hidden; display:flex; flex-direction:column;">
        <div style="display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-bottom:1px solid #e5e7eb;">
          <div style="font-weight:600; font-size:16px; color:#111827;">Repost with your thoughts</div>
          <button id="repostThoughtsClose1" style="background:transparent; border:0; font-size:18px; cursor:pointer; color:#4b5563">√ó</button>
        </div>
        <div style="padding:12px 14px; flex:1; overflow:auto;">
          <div style="margin-bottom:12px;">
            <textarea id="repostThoughtsInput1" placeho-lder="Say something about this" style="width:100%; min-height:80px; border:1px solid #e5e7eb; border-radius:8px; padding:10px 12px; font-family:inherit; resize:vertical;"></textarea>
          </div>
          <div style="font-weight:600; font-size:14px; color:#111827; margin-bottom:8px;">Original Post</div>
          <div id="repostOriginalPreview1" style="border:2px solid #e5e7eb; border-radius:8px; padding:10px; background:#f9fafb;"></div>
        </div>
        <div style="padding:10px 14px; border-top:1px solid #e5e7eb; display:flex; justify-content:flex-end; gap:8px;">
          <button id="repostThoughtsCancel1" style="background:transparent; color:#111827; border:1px solid #e5e7eb; border-radius:8px; padding:8px 14px; font-weight:500; cursor:pointer; ">Cancel</button>
          <button class="repost-post" id="repostThoughtsPost1" style="background:#111827; color:#fff; border:0; border-radius:8px; padding:8px 14px; font-weight:600; cursor:pointer; repost-post:hover{background-color: #feba17; color: black;}">Post</button>
        </div>
      </div>
    </div>

    <!-- Repost popup (shared) -->
    <!-- <div id="repostPopup" class="repost-popup" role="dialog" aria-modal="true">
      <div class="option" data-action="repost-now">Repost to your timeline</div>
      <div class="option" data-action="repost-with-note">Repost with a note</div>
    </div> -->

    <!-- Account Pop-up (ArchiveHubs-style) -->
    <div id="accountPopupPanel" class="account-popup" style="display:none;">
      <!-- Banner Cover Photo -->
      <div class="account-popup-banner">
        <img src="images/header.jpg" alt="Cover Photo" class="account-banner-img">
      </div>
      <!-- User Info -->
      <div class="account-popup-userinfo underline clickable">
        <div class="account-popup-avatar">
          <a href="Archivehubs-Individual_Page/Individual_Bio_profile.html"><img src="images/profile.jpg" alt="User Profile Picture"></a>
        </div>
        <a href="./Archivehubs-Individual_Page/Individual_Bio_profile.html">
          <div class="account-popup-username">User</div>
        </a>
      </div>
      
              <!-- Account Switcher Section -->
        <div class="account-popup-switcher underline">
          <div class="account-switcher-item">
            <div class="account-switcher-avatar-container">
              <img src="images/profile.jpg" alt="User Profile Picture" class="account-switcher-avatar">
              <div class="switch-roller"></div>
            </div>
            <div class="account-switcher-info">
              <a href="./Archivehubs-Corporate-Page/corporate_page_loading.html"><div class="account-switcher-name">Corporate Page</div></a>
            </div>
          </div>
        </div>
      <!-- View Profile Button -->
      <div class="account-popup-view-profile-row">
        <button class="account-popup-view-profile">See all profiles</button>
      </div>
      <!-- Account Section -->
      <div class="account-popup-section account-popup-account">
        <div class="account-popup-account-row highlight">
          <img src="images/profile.jpg" alt="Company Logo" class="account-popup-account-icon">
          <div class="account-popup-account-info">
            <div class="account-popup-account-name">Archivehubs Explorer</div>
            <div class="account-popup-premium"><a href="#">Try free Premium for 1 month</a></div>
          </div>
        </div>
        <!-- New: More popup links with icons -->
        <div class="account-popup-link">
          <i class="fa fa-gear"></i>
          <span>Settings & privacy</span>
          <i class="fa fa-angle-right right-arrow"></i>
        </div>
        <div class="account-popup-link">
          <i class="fa fa-question-circle"></i>
          <span>Help & Support</span>
          <i class="fa fa-angle-right right-arrow"></i>
        </div>
        <div class="account-popup-link">
          <i class="fa fa-moon"></i>
          <span>Display & Accessibility</span>
          <i class="fa fa-angle-right right-arrow"></i>
        </div>
        <div class="account-popup-link">
          <i class="fa fa-calendar"></i>
          <span>Planner (APS)</span>
          <i class="fa fa-angle-right right-arrow"></i>
        </div>
        <div class="account-popup-link">
          <i class="fa fa-folder-open"></i>
          <span>Archivehubs Explorer</span>
          <i class="fa fa-angle-right right-arrow"></i>
        </div>
        <div class="account-popup-link">
          <i class="fa fa-hdd"></i>
          <span>Archivehubs Drive</span>
          <i class="fa fa-angle-right right-arrow"></i>
        </div>
        <div class="account-popup-link">
          <i class="fa fa-file-alt"></i>
          <span>General Terms</span>
          <i class="fa fa-angle-right right-arrow"></i>
        </div>
      </div>
      <hr class="account-popup-divider">
      <!-- Sign Out -->
      <div class="account-popup-signout-row">
        <button class="account-popup-signout">Sign Out</button>
      </div>
    </div>

        

      

<script src="js/script.js"></script>


  <script>
    window.addEventListener('DOMContentLoaded', function() {
  const accountNavLink = document.getElementById('accountPopup');
  const accountPopupPanel = document.getElementById('accountPopupPanel');

  if (accountNavLink && accountPopupPanel) {
    accountNavLink.addEventListener('click', function(e) {
      e.preventDefault();
      // Position the popup under the nav-link
      const rect = accountNavLink.getBoundingClientRect();
      accountPopupPanel.style.top = (rect.bottom + window.scrollY + 8) + 'px';
      accountPopupPanel.style.right = (window.innerWidth - rect.right - 8) + 'px';
      accountPopupPanel.style.display = (accountPopupPanel.style.display === 'none' || accountPopupPanel.style.display === '') ? 'block' : 'none';
    });
    // Hide popup when clicking outside
    document.addEventListener('mousedown', function(e) {
      if (accountPopupPanel.style.display !== 'none' && !accountPopupPanel.contains(e.target) && !accountNavLink.contains(e.target)) {
        accountPopupPanel.style.display = 'none';
      }
    });
  }
});
  </script>
  <script>
    // Repost popup logic
    (function(){
      // Localized popup for the FIRST post only
      const btn = document.getElementById('repost-btn-1');
      const localPopup = document.getElementById('repost-expanded-1');
      if(!btn || !localPopup) return;

      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        localPopup.style.display = localPopup.style.display === 'block' ? 'none' : 'block';
      });

      // Close if clicking outside
      document.addEventListener('mousedown', (e) => {
        if (!localPopup.contains(e.target) && e.target !== btn && !btn.contains(e.target)){
          localPopup.style.display = 'none';
        }
      });

      // Handle option clicks
      localPopup.addEventListener('click', (e) => {
        const thoughtBtn = e.target.closest('#thoughtRepost-btn-1');
        // If clicking 'Repost with your thoughts'
        if (thoughtBtn){
          localPopup.style.display = 'none';
          // Build a simple preview of the original post (clone first post element)
          const firstPost = thoughtBtn.closest('.post');
          const previewContainer = document.getElementById('repostOriginalPreview1');
          const modal = document.getElementById('repostThoughtsModal1');
          if (firstPost && previewContainer && modal){
            const clone = firstPost.cloneNode(true);
            // Remove action areas from preview to avoid nested interactions
            const actions = clone.querySelectorAll('.post-actions, .repost-expanded');
            actions.forEach(a => a.remove());
            previewContainer.innerHTML = '';
            previewContainer.appendChild(clone);
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
          }
          return;
        }
        // Otherwise any click inside closes the small popup
        localPopup.style.display = 'none';
      });
    })();
  </script>
  <script>
    // Share modal (first post)
    (function(){
      const openBtn = document.getElementById('share-btn-1');
      const modal = document.getElementById('shareModal1');
      const overlay = document.getElementById('shareOverlay1');
      const closeBtn = document.getElementById('shareClose1');
      if(!openBtn || !modal) return;

      function open(){ modal.style.display = 'block'; document.body.style.overflow='hidden'; }
      function close(){ modal.style.display = 'none'; document.body.style.overflow=''; }

      openBtn.addEventListener('click', (e)=>{ e.preventDefault(); open(); });
      overlay.addEventListener('click', close);
      closeBtn.addEventListener('click', close);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.style.display==='block') close(); });
    })();
  </script>
  <script>
    // Repost with thoughts modal controls (first post)
    (function(){
      const modal = document.getElementById('repostThoughtsModal1');
      if(!modal) return;
      const overlay = document.getElementById('repostThoughtsOverlay1');
      const closeBtn = document.getElementById('repostThoughtsClose1');
      const cancelBtn = document.getElementById('repostThoughtsCancel1');
      const postBtn = document.getElementById('repostThoughtsPost1');

      function close(){ modal.style.display='none'; document.body.style.overflow=''; }

      overlay.addEventListener('click', close);
      closeBtn.addEventListener('click', close);
      cancelBtn.addEventListener('click', close);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.style.display==='block') close(); });

      // Placeholder: post action just closes for now
      postBtn.addEventListener('click', ()=>{ close(); });
    })();
  </script>

  <script>
    // Theme Toggle
      const themeToggle = document.getElementById('theme-toggle');
      themeToggle.addEventListener('click', () => {
        document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark';
          });
  
          // Mobile Menu Toggle
          const menuToggle = document.querySelector('.menu-toggle');
          const dropdownMenu = document.querySelector('.dropdown-menu');
          menuToggle.addEventListener('click', () => {
              dropdownMenu.classList.toggle('show');
          });

        document.addEventListener('DOMContentLoaded', function() {
          const searchTriggerBtn = document.getElementById('searchTriggerBtn');
          const searchView = document.getElementById('searchView');
          const searchBackBtn = document.getElementById('searchBackBtn');
          const searchInput = document.getElementById('searchInput');

        if (searchTriggerBtn && searchView && searchBackBtn && searchInput) {
            // Open search
            searchTriggerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                searchView.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scroll
                setTimeout(() => {
                    searchInput.focus();
                }, 50);
            });

            // Close search
            searchBackBtn.addEventListener('click', function(e) {
                e.preventDefault();
                searchView.classList.remove('active');
                document.body.style.overflow = ''; // Restore scroll
            });

            // Close on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && searchView.classList.contains('active')) {
                    searchView.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

    // --- DOM Elements Cache ---
    const menuBtn = document.getElementById('menuControl');
    const menuItems = document.getElementById('manageConversations-menuItems');
    const toggleWidgetBtn = document.getElementById('toggleWidget-btn');
    const arrowIcon = toggleWidgetBtn.querySelector('.material-symbols-outlined');
    const messageWidgetHeader = document.querySelector('.messageWidget');
    const widgetExtended = document.querySelector('.messageWidget-extended');
    const focusedBtn = document.getElementById('focusedTab');
    const othersBtn = document.getElementById('othersTab');
    const focusedChats = document.getElementById('focusedChats');
    const otherChats = document.getElementById('otherChats');
    const searchInput = document.getElementById('searchBar');
    const manageConversationsBtn = document.getElementById('manageConversations');
    const messageSettingBtn = document.getElementById('messageSettings');
    const messageSettingModal = document.getElementById('messageSetting-modal');
    const messageSettingCloseBtn = document.getElementById('cancelMessage-settingBtn');
    const awayMessageBtn = document.getElementById('awayMessage');
    const awayMessageModal = document.getElementById('awayModal');
    const awayMessageCloseBtn = document.getElementById('awayModal-cancelBtn');
    const wordCounter = document.getElementById('wordCounter');
    const awayMessageInput = document.getElementById('awayMessenger');
    const maxWords = 300;
    const chatThreadContainer = document.getElementById('chatThread-container');
    const backToChatListBtn = document.getElementById('backToChatList-btn');
    const threadContactName = document.getElementById('threadContactName');
    const threadContactPic = document.getElementById('threadContactPicture');
    const chatThreadMessages = document.getElementById('chatThread-messages');
    const messageInput = document.getElementById('messageInput'); // Now handles text + previews
    const sendMessageBtn = document.getElementById('sendMessage-btn');
    const chatHeaderDropdown = document.getElementById('chatHeader-dropdownMenu');
    const chatHeaderDropdownInitializer = document.getElementById('chatHeader-dropdownInitializer');
    const chatListContainer = document.querySelector('.messageType-content');
    const messageNavigation = document.querySelector('.messageNavigation');

    // Attachment buttons and hidden input
    const attachImageBtn = document.getElementById('attachImage-btn');
    const attachFileBtn = document.getElementById('attachFile-btn'); // For documents, etc.
    const emojiBtn = document.getElementById('emoji-btn'); // For emojis
    const attachmentInput = document.getElementById('attachmentInput'); // The single hidden file input

    let currentOpenChatItem = null;
    // Temporary storage for attachments before sending
    let pendingAttachments = [];

    //date separator set to track inserted dates
    const insertedDates = new Set();
    const lastMessageDates = new Map();


    // --- Global Data Store ---
    const chats = {
        focused: [{
            id: 'chat1',
            name: 'John Doe',
            profilePic: 'Images/Placeholder1.jpg',
            preview: 'Hey, how are you?',
            timestamp: '2025-07-28T10:00:00Z'
        }, {
            id: 'chat2',
            name: 'Jane Smith',
            profilePic: 'Images/placeholder2.jpg',
            preview: 'Let\'s catch up soon!',
            timestamp: '2025-07-28T09:30:00Z'
        }],
        others: [{
            id: 'chat3',
            name: 'Alice Johnson',
            profilePic: 'Images/user.png',
            preview: 'Are we still on for tomorrow?',
            timestamp: '2025-07-27T10:00:00Z'
        }, {
            id: 'chat4',
            name: 'Bob Brown',
            profilePic: 'Images/user.png',
            preview: 'Can you send me the files?',
            timestamp: '2025-07-26T09:00:00Z'
        }]
    };

    //all Messages structure to support mixed content (text + attachments)
    const allMessages = {
        'chat1': [
            { sender: 'John Doe', content: [{ type: 'text', value: 'Hey, how are you?' }], isSent: false, timestamp: '2025-07-28T10:01:00Z' },
            { sender: 'You', content: [{ type: 'text', value: 'I\'m doing great, thanks for asking! What\'s up?' }], isSent: true, timestamp: '2025-07-28T10:02:00Z' },
            { sender: 'John Doe', content: [{ type: 'text', value: 'Just wanted to check in. Been a while!' }], isSent: false, timestamp: '2025-07-28T14:05:00Z' },
            // Example of a message with both text and an image:
            { sender: 'You', content: [{ type: 'text', value: 'Check out this cool placeholder image!' }, { type: 'image', value: { url: 'Images/Placeholder1.jpg', name: 'placeholder.png' } }], isSent: true, timestamp: '2025-07-28T14:30:00Z' },
            // Example of a message with just an image:
            { sender: 'John Doe', content: [{ type: 'image', value: { url: 'Images/placeholder2.jpg', name: 'sent_pic.png' } }], isSent: false, timestamp: '2025-07-28T15:00:00Z' },
        ],
        'chat2': [
            { sender: 'Jane Smith', content: [{ type: 'text', value: 'Let\'s catch up soon!' }], isSent: false, timestamp: '2025-07-28T09:30:00Z' },
        ],
        'chat3': [
            { sender: 'Alice Johnson', content: [{ type: 'text', value: 'Are we still on for tomorrow?' }], isSent: false, timestamp: '2025-07-27T10:00:00Z' },
            { sender: 'You', content: [{ type: 'text', value: 'Yes! Looking forward to it.' }], isSent: true, timestamp: '2025-07-27T10:05:00Z' },
        ],
        'chat4': [
            { sender: 'Bob Brown', content: [{ type: 'text', value: 'Can you send me the files?' }], isSent: false, timestamp: '2025-07-26T09:00:00Z' },
            { sender: 'You', content: [{ type: 'text', value: 'Sure, they should be in your inbox now.' }], isSent: true, timestamp: '2025-07-26T09:05:00Z' },
        ],
    };

    /* --- Utility Functions ---

    function formatTimeAgo(timestamp) {
        const now = new Date();
        const time = new Date(timestamp);
        const diffSeconds = Math.floor((now - time) / 1000);
        if (diffSeconds < 60) return 'Just Now';
        if (diffSeconds < 3600) return `${Math.floor(diffSeconds / 60)} min ago`;
        if (diffSeconds < 86400) return `${Math.floor(diffSeconds / 3600)} hr${Math.floor(diffSeconds / 3600) === 1 ? '' : 's'} ago`;
        if (diffSeconds < 604800) return `${Math.floor(diffSeconds / 86400)} day${Math.floor(diffSeconds / 86400) === 1 ? '' : 's'} ago`;
        return time.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }*/
    function formatTimeAgo(timestamp) {
    const now = new Date();
    const time = new Date(timestamp);
    const seconds = Math.floor((now - time) / 1000);

    if (seconds < 60) return 'Just Now';

    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) {
        return minutes === 1 ? '1 min ago' : `${minutes} mins ago`;
    }

    const hours = Math.floor(minutes / 60);
    if (hours < 24) {
        return hours === 1 ? '1 hr ago' : `${hours} hrs ago`;
    }

    const days = Math.floor(hours / 24);
    if (days < 7) {
        return days === 1 ? '1 day ago' : `${days} days ago`;
    }

    // You can add more granular checks (e.g., for a week, month, etc.)
    // For now, let's format it for a date older than a week.
    return time.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    function toggleHiddenClass(element) {
        element.classList.toggle('hidden');
    }

    /**
     * Helper to update send button state (will be called from input and attachment logic)
     */
    function updateSendMessageButtonState() {
        // Check if there's actual text content (not just spaces or empty divs from previews)
        const hasText = messageInput.textContent.trim().length > 0 &&
                        messageInput.childNodes.length > 0 && // Ensure there are actual nodes
                        Array.from(messageInput.childNodes).some(node =>
                            node.nodeType === 3 && node.textContent.trim().length > 0 // Text node with content
                        );
        const hasAttachments = pendingAttachments.length > 0;
        sendMessageBtn.disabled = !(hasText || hasAttachments);
    }



        
        /**
     * Adds a message bubble to the chat thread UI, handling various content types.
     * @param {string} senderName - Name of the sender.
     * @param {Array<{type: string, value: string | {url: string, name: string, size?: number}}>} contentArray - Array of content objects.
     * @param {boolean} isSentByCurrentUser - True if the message is from the current user.
     * @param {string} [avatarSrc] - Optional URL for the sender's avatar.
     * @param {string} timestamp - The ISO 8601 formatted timestamp of the message.
     */
    function addMessageToThread(senderName, contentArray, isSentByCurrentUser, avatarSrc = '', timestamp) {
        const messageDate = new Date(timestamp);
        const lastDate = lastMessageDates.get(senderName);
        const messageTime = messageDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

        const lastMessage = chatThreadMessages.lastElementChild;
        let lastMessageDate = null;
        if (lastMessage && lastMessage.dataset.timestamp) {
            lastMessageDate = new Date(lastMessage.dataset.timestamp);
        }

        // Add date separator if it's a new day
        // Create a consistent date string (e.g., "2025-08-03")
        const currentDateKey = messageDate.toISOString().split('T')[0];

    if (lastDate !== currentDateKey) {
    lastMessageDates.set(senderName, currentDateKey);

    const dateSeparator = document.createElement('div');
    dateSeparator.classList.add('date-separator');
    dateSeparator.textContent = messageDate.toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    chatThreadMessages.appendChild(dateSeparator);
    }


        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message');
        messageDiv.classList.add(isSentByCurrentUser ? 'sent' : 'received');
        messageDiv.dataset.timestamp = timestamp;

        //assign unique ID to messages
        const uniqueID = 'msg-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
        messageDiv.dataset.messageId = uniqueID;

        // --- NEW: Separate logic for sent and received messages ---
        if (isSentByCurrentUser) {
    const menuContainer = document.createElement('div');
    menuContainer.className = 'message-menu';
    menuContainer.innerHTML = `
        <button class="menu-btn">
            <span class="material-symbols-outlined">more_vert</span>
        </button>
        <div class="dropdown-menu">
          <div class="dropdown-item">Edit Message</div>
            <div class="dropdown-item" id="delete-option">Delete Message</div>
            <div class="dropdown-item">Report Message</div>
        </div>
    `;
    messageDiv.appendChild(menuContainer);

    const menuBtn = menuContainer.querySelector('.menu-btn');
    const dropdown = menuContainer.querySelector('.dropdown-menu');

    menuBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        const currentlyVisible = dropdown.style.display === 'block';
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
            if (menu !== dropdown) menu.style.display = 'none';
        });
        dropdown.style.display = currentlyVisible ? 'none' : 'block';
    });
        } else if (avatarSrc) {
            // Add avatar for RECEIVED messages
            const avatarImg = document.createElement('img');
            avatarImg.src = avatarSrc;
            avatarImg.alt = senderName;
            avatarImg.classList.add('message-avatar');
            messageDiv.appendChild(avatarImg);
        }

        const messageContentWrapper = document.createElement('div');
        messageContentWrapper.classList.add('message-content-wrapper');

        const messageContent = document.createElement('div');
        messageContent.classList.add('message-content');

        contentArray.forEach(item => {
            if (item.type === 'text') {
                const textP = document.createElement('p');
                textP.textContent = item.value;
                messageContent.appendChild(textP);
            } else if (item.type === 'image') {
                const messageImage = document.createElement('img');
                messageImage.classList.add('message-image');
                messageImage.src = item.value.url;
                messageImage.alt = item.value.name || 'Attached image';
                messageContent.appendChild(messageImage);
            } else if (item.type === 'file') {
                const fileBlock = document.createElement('div');
                fileBlock.classList.add('file-block');

                const iconSpan = document.createElement('span');
                iconSpan.className = 'material-symbols-outlined file-icon';
                iconSpan.textContent = 'description';
                fileBlock.appendChild(iconSpan);

                const fileInfoDiv = document.createElement('div');
                fileInfoDiv.className = 'fileInfo';

                let displayName = item.value.name;
                if (displayName.length > 18) {
                    displayName = displayName.substring(0, 15) + '...';
                }

                const fileNameSpan = document.createElement('span');
                fileNameSpan.className = 'fileName';
                fileNameSpan.textContent = displayName;
                fileInfoDiv.appendChild(fileNameSpan);

                if (item.value.size) {
                    const fileSizeSpan = document.createElement('span');
                    fileSizeSpan.className = 'fileSize';
                    fileSizeSpan.textContent = `${(item.value.size / 1024).toFixed(1)} KB`;
                    fileInfoDiv.appendChild(fileSizeSpan);
                }

                fileBlock.appendChild(fileInfoDiv);

                const downloadBtn = document.createElement('a');
                downloadBtn.className = 'fileDownload-btn material-symbols-outlined';
                downloadBtn.href = item.value.url;
                downloadBtn.download = item.value.name;
                downloadBtn.title = 'Download';
                downloadBtn.className = 'material-symbols-outlined file-download-btn';
                downloadBtn.textContent = 'download';
                fileBlock.appendChild(downloadBtn);

                messageContent.appendChild(fileBlock);
            }
        });

        const messageTimeSpan = document.createElement('span');
        messageTimeSpan.classList.add('message-time');
        messageTimeSpan.textContent = messageTime;
        messageContent.appendChild(messageTimeSpan);


        messageContentWrapper.appendChild(messageContent);
        messageDiv.appendChild(messageContentWrapper);
        chatThreadMessages.appendChild(messageDiv);
        chatThreadMessages.scrollTop = chatThreadMessages.scrollHeight;
    }

        /**
     * Creates and returns a DOM element for a single chat item.
     * @param {object} chat - The chat data object.
     * @returns {HTMLElement} The created .chatItem element.
     */
    function createChatItemElement(chat) {
        const chatItem = document.createElement('div');
        chatItem.classList.add('chatItem');
        chatItem.dataset.contactId = chat.id;
        chatItem.dataset.profilePic = chat.profilePic;
        chatItem.dataset.timestamp = chat.timestamp;
        chatItem.innerHTML = `
            <img src="${chat.profilePic}" alt="${chat.name}" class="profilePic">
            <div class='chatDetails'>
                <div class='nameTime'>
                    <span class='userName'>${chat.name}</span>
                    <span class='time'>${formatTimeAgo(chat.timestamp)}</span>
                </div>
                <div class='preview'>${chat.preview}</div>
            </div>
        `;
        return chatItem;
    }

    /**
     * Renders a list of chat items into a specified container.
     * @param {Array<object>} chatArray - An array of chat data objects.
     * @param {HTMLElement} containerElement - The DOM element to render into.
     */
    function renderChatList(chatArray, containerElement) {
        containerElement.innerHTML = '';
        if (chatArray && chatArray.length > 0) {
            chatArray.forEach(chat => {
                const chatItem = createChatItemElement(chat);
                containerElement.appendChild(chatItem);
            });
        } else {
            containerElement.innerHTML = '<div class="noMatch">No conversations found</div>';
        }
    }

    function openChatThread(chatItemElement) {
        currentOpenChatItem = chatItemElement;
        const contactName = chatItemElement.querySelector('.userName').textContent;
        const contactPic = chatItemElement.dataset.profilePic || 'Images/user.png';
        const contactId = chatItemElement.dataset.contactId;

        threadContactName.textContent = contactName;
        threadContactPic.src = contactPic;

        messageNavigation.classList.add('hidden');
        chatListContainer.classList.add('hidden');
        chatThreadContainer.classList.remove('hidden');

        chatThreadMessages.innerHTML = '';
        const messagesForThisChat = allMessages[contactId] || [];

        if (messagesForThisChat.length === 0) {
            const noMessagesYetElement = document.createElement('div');
            noMessagesYetElement.className = 'no-messages-yet';
            noMessagesYetElement.textContent = 'No messages yet. Say hello!';
            chatThreadMessages.appendChild(noMessagesYetElement);
        } else {
            messagesForThisChat.forEach(msg => {
                // Pass msg.content directly, as it's now an array
                addMessageToThread(
                    msg.sender,
                    msg.content, // This is now an array
                    msg.isSent,
                    msg.isSent ? '' : contactPic,
                    msg.timestamp
                );
            });
        }

        // Clear input and pending attachments when opening a new chat
        messageInput.innerHTML = ''; // Use innerHTML for contenteditable to clear previews too
        messageInput.style.height = 'auto';
        pendingAttachments = []; // Clear pending attachments
        updateSendMessageButtonState(); // Update send button state
    }


    function updateAllChatTimes() {
        const chatItem = document.querySelectorAll('.chatItem');
        chatItem.forEach(item => {
            const timestamp = item.dataset.timestamp;
            const timeElement = item.querySelector('.time');
            if (timestamp && timeElement) {
                timeElement.textContent = formatTimeAgo(timestamp);
            }
        });
    }
    // --- Event Listeners ---

    // Widget Toggle and Menu
    menuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        menuItems.classList.toggle('hidden');
    });

    window.addEventListener('click', (e) => {
        if (!menuItems.contains(e.target) && !menuBtn.contains(e.target)) {
            menuItems.classList.add('hidden');
        }
        // Also close chat header dropdown if clicked outside
        if (!chatHeaderDropdown.contains(e.target) && !chatHeaderDropdownInitializer.contains(e.target)) {
            chatHeaderDropdown.classList.add('hidden');
        }
    });

    manageConversationsBtn.addEventListener('click', () => {
        widgetExtended.classList.toggle('show');
        arrowIcon.classList.toggle('rotate');
        menuItems.classList.add('hidden');
    });

    toggleWidgetBtn.addEventListener('click', () => {
        widgetExtended.classList.toggle('show');
        arrowIcon.classList.toggle('rotate');
        menuItems.classList.add('hidden');
    });

    // Tab Switching
    messageNavigation.addEventListener('click', (e) => {
        const clickedBtn = e.target.closest('button');
        if (!clickedBtn) return;
        focusedBtn.classList.remove('active');
        othersBtn.classList.remove('active');
        focusedChats.classList.remove('active');
        otherChats.classList.remove('active');
        clickedBtn.classList.add('active');
        const targetTab = clickedBtn.dataset.tab;
        if (targetTab === 'focused') {
            focusedChats.classList.add('active');
        } else if (targetTab === 'others') {
            otherChats.classList.add('active');
        }
        searchInput.dispatchEvent(new Event('input'));
    });

    // Search Functionality
    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase().trim();
        const activeChatList = document.querySelector('.chatList.active');
        if (!activeChatList) return;
        const chatItems = activeChatList.querySelectorAll('.chatItem');
        let listHasMatch = false;

        chatItems.forEach(item => {
            const name = item.querySelector('.userName')?.textContent.toLowerCase() || '';
            const preview = item.querySelector('.preview')?.textContent.toLowerCase() || '';
            const isMatch = name.includes(query) || preview.includes(query);
            if (isMatch) {
                item.style.display = 'flex';
                listHasMatch = true;
            } else {
                item.style.display = 'none';
            }
        });

        let noMatchEl = activeChatList.querySelector('.noMatch');
        if (query.length > 0 && !listHasMatch) {
            if (!noMatchEl) {
                noMatchEl = document.createElement('div');
                noMatchEl.className = 'noMatch';
                noMatchEl.textContent = 'No match found';
                activeChatList.appendChild(noMatchEl);
            }
        } else if (noMatchEl) {
            noMatchEl.remove();
        }
    });

    // Modals
    messageSettingBtn.addEventListener('click', () => {
        toggleHiddenClass(messageSettingModal);
        menuItems.classList.add('hidden');
    });
    messageSettingCloseBtn.addEventListener('click', () => toggleHiddenClass(messageSettingModal));
    awayMessageBtn.addEventListener('click', () => {
        toggleHiddenClass(awayMessageModal);
        menuItems.classList.add('hidden');
    });
    awayMessageCloseBtn.addEventListener('click', () => toggleHiddenClass(awayMessageModal));
    awayMessageInput.addEventListener('input', () => {
        const text = awayMessageInput.value.trim();
        const words = text.split(/\s+/).filter(w => w.length > 0);
        wordCounter.textContent = `${Math.min(words.length, maxWords)}/${maxWords}`;
    });

    // Chat Thread Interface
    chatListContainer.addEventListener('click', (e) => {
        const chatItem = e.target.closest('.chatItem');
        if (chatItem) {
            openChatThread(chatItem);
        }
    });

    /* Back to chat list button*/
    backToChatListBtn.addEventListener('click', () => {
    if (currentOpenChatItem) {
        const contactId = currentOpenChatItem.dataset.contactId;
        const currentChatMessages = allMessages[contactId] || [];

        // Find the last message that is not marked as "deleted"
        const lastValidMessage = currentChatMessages.slice().reverse().find(msg => {
            // Check if the content is an array and the first item's value is not "Message deleted"
            const contentValue = Array.isArray(msg.content) ? msg.content[0]?.value : msg.content;
            return contentValue !== 'Message deleted' && contentValue !== undefined;
        });

        if (lastValidMessage) {
            let previewText = '';
            if (Array.isArray(lastValidMessage.content)) {
                lastValidMessage.content.forEach(item => {
                    if (item.type === 'text') {
                        previewText += item.value + ' ';
                    } else if (item.type === 'image') {
                        previewText += '[Image] ';
                    } else if (item.type === 'file') {
                        previewText += '[File] ';
                    }
                });
            } else if (typeof lastValidMessage.content === 'string') {
                previewText = lastValidMessage.content;
            }
            
            previewText = previewText.trim();
            currentOpenChatItem.querySelector('.preview').textContent = previewText.length > 40 ? previewText.substring(0, 37) + '...' : previewText;
            currentOpenChatItem.querySelector('.time').textContent = formatTimeAgo(lastValidMessage.timestamp);
            currentOpenChatItem.dataset.timestamp = lastValidMessage.timestamp;
        } else {
            // If all messages are deleted or there are no messages
            currentOpenChatItem.querySelector('.preview').textContent = 'No messages yet.';
            currentOpenChatItem.querySelector('.time').textContent = '';
            currentOpenChatItem.dataset.timestamp = '';
        }
    }

    chatThreadContainer.classList.add('hidden');
    messageNavigation.classList.remove('hidden');
    chatListContainer.classList.remove('hidden');
    currentOpenChatItem = null;
    });

    // Attach Image Button Click
    attachImageBtn.addEventListener('click', () => {
        attachmentInput.accept = 'image/*'; // Set accept attribute for image selection
        attachmentInput.click(); // Trigger file input
    });

    //Attach File Button Click (for documents etc.)
    attachFileBtn.addEventListener('click', () => {
        // You can specify more MIME types if needed (e.g., .doc, .ppt, .xls)
        attachmentInput.accept = '.pdf, .doc, .docx, .xls, .xlsx, .txt, .zip, .rar';
        attachmentInput.click();
    });

    // Handle file selection from the hidden input
    attachmentInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const fileUrl = e.target.result; // Base64 URL for image, or general data URL for file

                let previewElement;
                let attachmentData;

                // Determine file type and create appropriate preview
                if (file.type.startsWith('image/')) {
                    previewElement = document.createElement('img');
                    previewElement.src = fileUrl;
                    previewElement.classList.add('input-image-preview');
                    attachmentData = { type: 'image', value: { url: fileUrl, name: file.name, type: file.type, size: file.size } };
                } else {
                    // For other file types, show a file icon and name
                    previewElement = document.createElement('span');
                    previewElement.classList.add('input-file-preview');
                    // Add a file icon (assuming you have material icons loaded)
                    previewElement.innerHTML = `<span class="material-symbols-outlined">description</span> ${file.name}`;
                    attachmentData = { type: 'file', value: { url: fileUrl, name: file.name, type: file.type, size: file.size } };
                }

                // Append a "remove" button to the preview
                const removeButton = document.createElement('span');
                removeButton.classList.add('attachment-remove-btn');
                removeButton.innerHTML = '&times;'; // 'x' symbol
                removeButton.onclick = (e) => {
                    e.stopPropagation(); // Prevent messageInput focus
                    // Find the parent container (attachment-preview-container) and remove it
                    e.target.closest('.attachment-preview-container').remove();
                    // Remove from pendingAttachments array by finding its index
                    const indexToRemove = pendingAttachments.indexOf(attachmentData);
                    if (indexToRemove > -1) {
                        pendingAttachments.splice(indexToRemove, 1);
                    }
                    updateSendMessageButtonState(); // Update send button state
                };

                const previewContainer = document.createElement('div');
                previewContainer.classList.add('attachment-preview-container');
                // Use a unique ID based on a combination of timestamp and file name to ensure uniqueness
                previewContainer.dataset.attachmentId = `${Date.now()}-${file.name}`;
                previewContainer.appendChild(previewElement);
                previewContainer.appendChild(removeButton);

                
                // Add to messageInput. Insert at the end to keep text first if user types.
                messageInput.appendChild(previewContainer);

                // Add to pending attachments
                pendingAttachments.push(attachmentData);

                // Clear the file input value for subsequent selections
                attachmentInput.value = '';

                // Update send button state
                updateSendMessageButtonState();

                // Adjust messageInput height
                messageInput.style.height = 'auto';
                messageInput.style.height = messageInput.scrollHeight + 'px';
            };
            reader.readAsDataURL(file); // Read the file as a data URL (Base64)
        }
    });


    //emoji picker control
    const emojiPicker = document.getElementById('emojiPicker');

    if (emojiPicker && emojiBtn) {
    document.body.appendChild(emojiPicker);

    //define its structure

    emojiBtn.addEventListener('click', function () {
      emojiPicker.classList.toggle('hidden');

      if (!emojiPicker.classList.contains('hidden')) {
        const buttonRect = emojiBtn.getBoundingClientRect();

        //aligning it ot the button
        const pickerWidth = emojiPicker.offsetWidth;
        const pickerHeight = emojiPicker.offsetHeight;

        //calculate top position to place the popup
        const topPosition = buttonRect.top + window.scrollY - pickerHeight -10;
        //calculate left position
        const leftPosition = buttonRect.left + window.scrollX;

        emojiPicker.style.position = 'absolute'
        emojiPicker.style.top = `${topPosition}px`;
        emojiPicker.style.left = `${leftPosition}px`;
      }
    });
    }

    //hide menu on outside click
    document.addEventListener('click', function(event) {
    if (emojiPicker && emojiBtn && !emojiPicker.classList.contains('hidden')) {
      const isClickedInsidePicker = emojiPicker.contains(event.target);
      const isClickOnButton = emojiBtn.contains(event.target);

      if (!isClickedInsidePicker && !isClickOnButton) {
        emojiPicker.classList.add('hidden');
      }
    }
    });

    //inserting emeoji into the editor
    if (messageInput && emojiPicker) {
    emojiPicker.addEventListener('click', function(event) {
      const clickedButton = event.target.closest('button');

      if (clickedButton && clickedButton.parentElement && clickedButton.parentElement.classList.contains('emojiGrid')) {
        const emoji = clickedButton.textContent;

        if (messageInput.contentEditable === 'true') {
          const selection = window.getSelection();

          if (selection.rangeCount > 0 && messageInput.contains(selection.anchorNode)) {
            const range = selection.getRangeAt(0); //get current cursor position

            const emojiNode = document.createTextNode(emoji);

            //insert emoji at current cursor position
            range.deleteContents();
            range.insertNode(emojiNode);

            //move cursor after the inserted emoji
            range.setStartAfter(emojiNode);
            range.setEndAfter(emojiNode);
            selection.removeAllRanges();
            selection.addRange(range);

            //placeholder updating
            if (messageInput.textContent.trim() !== '') {
              messageInput.classList.add('has-content');
            } else {
              messageInput.classList.remove('has-content');
            }
          } else {
            messageInput.textContent += emoji;
            //manually trigger input event
            messageInput.dispatchEvent(new Event('input', {bubbles: true}));
            if (messageInput.textContent.trim() !== '') {
              messageInput.classList.add('has-content');
            } else {
              messageInput.classList.remove('has-content');
            }
          }
        } 
      }
    })
    }



    sendMessageBtn.addEventListener('click', () => {
        // Collect text content from the messageInput, excluding attachment previews
        let messageText = '';
        Array.from(messageInput.childNodes).forEach(node => {
            // Ignore attachment preview containers
            if (
                node.nodeType === 3 // TEXT_NODE
                || (node.nodeType === 1 && !node.classList.contains('attachment-preview-container')) // ELEMENT_NODE
            ) {
                messageText += node.textContent;
            }
        });
        messageText = messageText.trim();

        const contentToSend = [];
        if (messageText) {
            contentToSend.push({ type: 'text', value: messageText });
        }
        pendingAttachments.forEach(att => {
            contentToSend.push(att);
        });

        if (contentToSend.length > 0) {
            const contactId = currentOpenChatItem.dataset.contactId;
            const contactPic = currentOpenChatItem.dataset.profilePic;
            const now = new Date().toISOString();

            // Add combined message to UI
            addMessageToThread('You', contentToSend, true, contactPic, now);

            // Store combined message data
            allMessages[contactId].push({ sender: 'You', content: contentToSend, isSent: true, timestamp: now });

            // Clear message input and pending attachments
            messageInput.innerHTML = '';
            messageInput.style.height = 'auto';
            pendingAttachments = [];
            updateSendMessageButtonState();

            // Update chat list preview
            if (currentOpenChatItem) {
                let previewContent = '';
                if (messageText) {
                    previewContent = messageText.length > 30 ? messageText.substring(0, 27) + '...' : messageText;
                }
                if (contentToSend.some(item => item.type !== 'text')) {
                    if (previewContent) previewContent += ' ';
                    const fileCount = contentToSend.filter(item => item.type !== 'text').length;
                    previewContent += `[${fileCount} attachment${fileCount > 1 ? 's' : ''}]`;
                }
                currentOpenChatItem.querySelector('.preview').textContent = previewContent || 'Message sent';
                currentOpenChatItem.querySelector('.time').textContent = formatTimeAgo(now);
                currentOpenChatItem.dataset.timestamp = now;
            }
        }
    });

    // Listen for input changes in contenteditable div for enabling/disabling send button
    messageInput.addEventListener('input', () => {
        updateSendMessageButtonState(); // Update based on text and attachments
        messageInput.style.height = 'auto';
        messageInput.style.height = messageInput.scrollHeight + 'px';
    });

    chatHeaderDropdownInitializer.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleHiddenClass(chatHeaderDropdown);
    });

    // --- Initializations ---
    renderChatList(chats.focused, focusedChats);
    renderChatList(chats.others, otherChats);
    focusedChats.classList.add('active');
    focusedBtn.classList.add('active');
    updateSendMessageButtonState(); // Initial check on load

    setInterval(updateAllChatTimes,60000);


    //open the dropdown for individual message sent
    document.addEventListener('click', () => {
    document.querySelectorAll('.dropdown-menu').forEach(menu => {
        menu.style.display = 'none';
    });
    });


    /*delete messages*/
    document.querySelector('.chatThread-messages').addEventListener('click', (e) => {
    if (e.target.matches('.dropdown-item[id="delete-option"]')) {
        const messageWrapper = e.target.closest('.message');
        const confirmed = confirm('Are you sure you want to delete this message?');
        if (!confirmed) return;

        const messageId = messageWrapper.dataset.messageId;
        const contactId = currentOpenChatItem.dataset.contactId;

        const messagesForThisChat = allMessages[contactId] || [];
        const msgIndex = messagesForThisChat.findIndex(msg => msg.id === messageId);

        if (msgIndex !== -1) {
            // Update the data object to reflect the deletion
            messagesForThisChat[msgIndex].content = [{ type: 'text', value: 'Message deleted' }];
            // NEW: Save the updated allMessages object to localStorage
            localStorage.setItem('allMessagesData', JSON.stringify(allMessages));
        }

        const contentElement = messageWrapper.querySelector('.message-content');
        if (contentElement) {
            contentElement.innerHTML = `<p>Message deleted</p><span class="message-time">${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span>`;
            messageWrapper.classList.add('deleted-message-bubble');
        }

        const dropdownMenu = messageWrapper.querySelector('.message-menu');
        if (dropdownMenu) {
            dropdownMenu.remove();
        }
    }
    });
    });
  </script>

</body>
</html>
