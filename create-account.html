<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account - ArchiveHubs</title>   
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>   
    .signup-box {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 32px rgba(0,0,0,0.08);
        padding: 40px 32px 32px 32px;
        width: 100%;
        max-width: 500px;
        position: relative;
        margin: 0 auto;
    }
    .header {
        text-align: center;
        margin-bottom: 24px;
    }
    .logo-container img.logo {
        width: 150px;
        border-radius: 8px;
    }
    .signup-form {
        position: relative;
        min-height: 420px;
        overflow: hidden;
    }
    .form-part {
        display: none;
        position: absolute;
        width: 100%;
        left: 0;
        top: 0;
        background: #fff;
        transition: transform 0.5s cubic-bezier(.77,0,.18,1), opacity 0.5s;
        opacity: 0;
        z-index: 1;
    }
    .form-part.active {
        display: block;
        opacity: 1;
        position: relative;
        transform: translateX(0);
        z-index: 2;
    }
    .form-part.left {
        opacity: 0.5;
        transform: translateX(-100%);
        z-index: 1;
    }
    .form-part.right {
        opacity: 0.5;
        transform: translateX(100%);
        z-index: 1;
    }
    .form-part:not(.active) {
         display: none;
    }
    .name-group {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
    }
    .signup-form input[type="text"],
    .signup-form input[type="email"],
    .signup-form input[type="password"],
    .signup-form input[type="tel"],
    .signup-form select {
        width: 100%;
        padding: 12px 10px;
        margin-bottom: 16px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 1rem;
        background: #f8fafc;
        transition: border 0.2s;
    }
    .signup-form input:focus,
    .signup-form select:focus {
        border: 1.5px solid #007bff;
        outline: none;
    }
    .form-group label {
        font-weight: 500;
        margin-bottom: 6px;
        display: block;
    }
    .phone-input-container {
        display: flex;
        gap: 8px;
    }
    .country-select {
        min-width: 120px;
    }
    .directory-group {
        display: flex;
        gap: 10px;
        margin-bottom: 16px;
    }
    .terms-container {
        margin: 24px 0 16px 0;
    }
    .terms-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .terms-text {
        font-size: 0.97rem;
    }
    .form-nav {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
        margin-right: 10px;
    }
    .next-btn, .back-btn, .signup-button {
        padding: 10px 30px;
        border: none;
        border-radius: 4px;
        background: #FFD700;
        color: #000000;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
        border: 2px solid #000000;
        font-weight: 600;
    }
    .back-btn {
        background: #888;
        color: #fff;
        border: none;
    }
    .next-btn:focus, .back-btn:focus, .signup-button:focus {
        outline: 2px solid #007bff;
    }
    .signup-button {
        background: #FFD700;
        color: #000000;
        border: 2px solid #000000;
    }
    .signup-button:hover:not(:disabled) {
        background: #FFE44D;
    }
    .signup-button:disabled {
        background: #e4e6eb;
        color: #b0b3b8;
        border: none;
        cursor: not-allowed;
    }
    .login-link {
        text-align: center;
        margin-top: 18px;
    }
    .login-link a {
        color: #007bff;
        text-decoration: none;
        font-weight: 500;
    }
    .error-message {
        color: #e74c3c;
        font-size: 0.95rem;
        min-height: 18px;
        display: block;
        margin-bottom: 10px;
    }
    .success-message {
        color: #27ae60;
        font-size: 0.95rem;
        display: block;
        margin-bottom: 10px;
    }
    
    /* Account Type Selection Styles */
    .account-type-container {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 24px;
    }
    .account-type-option {
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #fafafa;
    }
    .account-type-option:hover {
        border-color: #007bff;
        background: #f0f8ff;
    }
    .account-type-option.selected {
        border-color: #007bff;
        background: #f0f8ff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    .account-type-content {
        display: flex;
        align-items: flex-start;
        gap: 16px;
    }
    .account-type-icon {
        font-size: 24px;
        color: #007bff;
        min-width: 40px;
    }
    .account-type-info h3 {
        margin: 0 0 8px 0;
        color: #333;
        font-size: 1.1rem;
    }
    .account-type-info p {
        margin: 0;
        color: #666;
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    /* Professional Status Fields */
    .professional-fields-group {
        margin-bottom: 20px;
    }
    .professional-fields-group .form-group {
        margin-bottom: 15px;
    }

    /* Loading Spinner */
    .loading-spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #000;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: 10px;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .button-content {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .confirm-account-btn {
        padding: 10px 30px;
        border: none;
        border-radius: 4px;
        background: #43b04a;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
        font-weight: 600;
        width: 100%;
    }
    .confirm-account-btn:hover:not(:disabled) {
        background: #38a03f;
    }
    .confirm-account-btn:disabled {
        background: #b0b3b8;
        cursor: not-allowed;
    }
</style>
</head>
<body>
   <div class="signup-container">
    <div class="signup-box">
        <div class="header">
            <div class="logo-container">
                <img src="images/hubs.jpg" alt="ArchiveHubs" class="logo">
            </div>
        </div>

        <form class="signup-form" id="multiStepForm">
            <!-- PART 1: Personal Details -->
            <div class="form-part active" id="part1">
                <h3 style="text-align: center; margin-bottom: 24px; color: #333;">Personal Details</h3>
                <span class="error-message" id="part1Error"></span>
                <div class="name-group">
                    <input type="text" id="firstName" placeholder="First Name" required>
                    <input type="text" id="lastName" placeholder="Surname" required>
                </div>
                <input type="text" id="otherName" placeholder="Other Name (optional)">
                <input type="email" id="email" placeholder="Your Email" required>
                <input type="password" id="password" placeholder="Your Password" required>
                <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <div class="phone-input-container">
                        <select class="country-select" id="countryCodeSelect">
                            <option value="" disabled selected>Country Code</option>
                            <option value="+234">Nigeria (+234)</option>
                            <option value="+1" disabled>USA/Canada (+1)</option>
                            <option value="+44" disabled>UK (+44)</option>
                            <option value="+91" disabled>India (+91)</option>
                        </select>
                    </div>
                    <input type="tel" id="phone" name="phone" placeholder="08034567890" required>
                    <span class="error-message" id="phoneError"></span>
                </div>
                <div class="directory-group">
                    <select id="sex" required>
                        <option value="" disabled selected>Sex</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                    <select id="country" required>
                        <option value="" disabled selected>Country</option>
                        <option value="Nigeria">Nigeria</option>
                        <option value="United States" disabled>United States</option>
                        <option value="United Kingdom" disabled>United Kingdom</option>
                        <option value="Canada" disabled>Canada</option>
                        <option value="Australia" disabled>Australia</option>
                        <option value="India" disabled>India</option>
                    </select>
                </div>
                <div class="directory-group">
                    <select id="state" required>
                        <option value="" disabled selected>State/Province</option>
                        <option value="Abia">Abia</option>
                        <option value="Adamawa">Adamawa</option>
                        <option value="Akwa Ibom">Akwa Ibom</option>
                        <option value="Anambra">Anambra</option>
                        <option value="Bauchi">Bauchi</option>
                        <option value="Bayelsa">Bayelsa</option>
                        <option value="Benue">Benue</option>
                        <option value="Borno">Borno</option>
                        <option value="Cross River">Cross River</option>
                        <option value="Delta">Delta</option>
                        <option value="Ebonyi">Ebonyi</option>
                        <option value="Edo">Edo</option>
                        <option value="Ekiti">Ekiti</option>
                        <option value="Enugu">Enugu</option>
                        <option value="Gombe">Gombe</option>
                        <option value="Imo">Imo</option>
                        <option value="Jigawa">Jigawa</option>
                        <option value="Kaduna">Kaduna</option>
                        <option value="Kano">Kano</option>
                        <option value="Katsina">Katsina</option>
                        <option value="Kebbi">Kebbi</option>
                        <option value="Kogi">Kogi</option>
                        <option value="Kwara">Kwara</option>
                        <option value="Lagos">Lagos</option>
                        <option value="Nasarawa">Nasarawa</option>
                        <option value="Niger">Niger</option>
                        <option value="Ogun">Ogun</option>
                        <option value="Ondo">Ondo</option>
                        <option value="Osun">Osun</option>
                        <option value="Oyo">Oyo</option>
                        <option value="Plateau">Plateau</option>
                        <option value="Rivers">Rivers</option>
                        <option value="Sokoto">Sokoto</option>
                        <option value="Taraba">Taraba</option>
                        <option value="Yobe">Yobe</option>
                        <option value="Zamfara">Zamfara</option>
                        <option value="Abuja">Abuja</option>                        
                    </select>
                </div>
                <div class="terms-container">
                    <label class="terms-checkbox">
                        <input type="checkbox" id="termsCheckbox" required>
                        <span class="terms-text">I agree to the Terms & Conditions and Privacy Policy</span>
                    </label>
                </div>
                <div class="form-nav">
                    <button type="button" class="signup-button" id="nextBtn">
                        <span class="button-content">
                            Next
                            <span class="loading-spinner" id="nextSpinner"></span>
                        </span>
                    </button>
                </div>
            </div>

            <!-- PART 2: Account Type Selection -->
            <div class="form-part" id="part2">
                <h3 style="text-align: center; margin-bottom: 24px; color: #333;">Choose Account Type</h3>
                <div class="account-type-container">
                    <div class="account-type-option" data-type="corporate">
                        <div class="account-type-content">
                            <div class="account-type-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="account-type-info">
                                <h3>Corporate Account</h3>
                                <p>Perfect for businesses and organizations. Includes team management, advanced analytics, and priority support.</p>
                            </div>
                        </div>
                    </div>
                    <div class="account-type-option" data-type="individual">
                        <div class="account-type-content">
                            <div class="account-type-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="account-type-info">
                                <h3>Individual Account</h3>
                                <p>Ideal for personal use. Simple and straightforward with all essential features.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-nav">
                    <button type="button" class="back-btn" id="backToStep1">Back</button>
                </div>
            </div>

            <!-- PART 3: Corporate Account Confirmation -->
            <div class="form-part" id="part3">
                <h3 style="text-align: center; margin-bottom: 24px; color: #333;">Corporate Account Details</h3>
                <span class="error-message" id="part3Error"></span>
                <span class="success-message" id="part3Success"></span>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>Corporate Account Type</label>
                    <select id="corporateAccountType" required>
                        <option value="" disabled selected>Select account type</option>
                        <option value="private">Private Corporation</option>
                        <option value="public">Public Corporation</option>
                        <option value="others">Others</option>
                    </select>
                    <input type="text" id="otherCorporateAccountTypeInput" placeholder="Please specify" style="display:none;" />
                </div>

                <div id="privateCorpGroups">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>Organization</label>
                        <select id="organizationSelect" required>
                            <option value="" disabled selected>Select your organization</option>
                            <option value="self-employed">Self-employed</option>
                            <option value="sole-proprietorship">Sole Proprietorship</option>
                            <option value="partnership">Partnership</option>
                            <option value="private-ltd">Private Limited Liability Company</option>
                            <option value="public-ltd">Public Limited Liability Company</option>
                            <option value="ngo">Non-Profit Organization (NGO)</option>
                            <option value="social-enterprise">Social Enterprise</option>
                            <option value="civil-society">Civil Society Organization</option>
                            <option value="cooperative-society">Cooperative Society</option>
                            <option value="community-initiative">Community Initiative Group</option>
                            <option value="faith-based">Faith Based Organization</option>
                            <option value="others">Others</option>
                        </select>
                        <input type="text" id="otherOrganizationInput" placeholder="Please specify" style="display:none;" />
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>Sector</label>
                        <select id="privateSectorSelect" required>
                            <option value="" disabled selected>Select your sector</option>
                            <option value="manufacturing">Manufacturing & Industrial</option>
                            <option value="retail">Retail & Wholesale</option>
                            <option value="professional-service">Professional Service</option>
                            <option value="ict">Information & Communication Technology (ICT)</option>
                            <option value="financial">Financial Services</option>
                            <option value="transport">Transport & Logistics</option>
                            <option value="real-estate">Real Estate & Construction</option>
                            <option value="healthcare">Healthcare & Life Sciences</option>
                            <option value="agriculture">Agriculture & Agribusiness</option>
                            <option value="media">Media, Entertainment & Creative Arts</option>
                            <option value="education">Education & Training</option>
                            <option value="energy">Energy & Environment</option>
                            <option value="others">Others</option>
                        </select>
                        <input type="text" id="otherPrivateSectorInput" placeholder="Please specify" style="display:none;" />
                    </div>
                </div>

                <div class="form-nav" style="flex-direction: column; gap: 10px;">
                    <button type="button" class="back-btn" id="backToStep2Corporate">Back</button>
                    <button type="button" class="confirm-account-btn" id="confirmCorporateAccountBtn">
                        <span class="button-content">
                            Confirm Account
                            <span class="loading-spinner" id="corporateSpinner"></span>
                        </span>
                    </button>
                </div>
            </div>

            <!-- PART 4: Individual Account Confirmation -->
            <div class="form-part" id="part4">
                <h3 style="text-align: center; margin-bottom: 24px; color: #333;">Individual Account Details</h3>
                <span class="error-message" id="part4Error"></span>
                <span class="success-message" id="part4Success"></span>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>Professional Status</label>
                    <select id="professionalStatus" required>
                        <option value="" disabled selected>Select your status</option>
                        <option value="student">Student</option>
                        <option value="unemployed">Unemployed</option>
                        <option value="employed">Employed</option>
                        <option value="self-employed">Self Employed</option>
                        <option value="retired">Retired</option>
                        <option value="others">Others</option>
                    </select>
                    <input type="text" id="otherProfessionalStatusInput" placeholder="Please specify" style="display:none;" />
                </div>

                <div class="professional-fields-group">
                    <div class="form-group" id="backgroundGroup" style="display: none;">
                        <label id="backgroundLabel">Background</label>
                        <select id="backgroundSelect">
                            <option value="" disabled selected>Select background</option>
                        </select>
                        <input type="text" id="otherBackgroundInput" placeholder="Please specify" style="display:none;" />
                    </div>

                    <div class="form-group" id="interestGroup" style="display: none;">
                        <label id="interestLabel">Interest</label>
                        <select id="interestSelect">
                            <option value="" disabled selected>Select interest</option>
                        </select>
                        <input type="text" id="otherInterestInput" placeholder="Please specify" style="display:none;" />
                    </div>
                </div>

                <div class="form-nav" style="flex-direction: column; gap: 10px;">
                    <button type="button" class="back-btn" id="backToStep2Individual">Back</button>
                    <button type="button" class="confirm-account-btn" id="confirmIndividualAccountBtn">
                        <span class="button-content">
                            Confirm Account
                            <span class="loading-spinner" id="individualSpinner"></span>
                        </span>
                    </button>
                </div>
            </div>
        </form>

        <div class="login-link">
            <a href="sign-in_account.html">Already have an account?</a>
        </div>
    </div>
</div>

<script>
    const API_BASE_URL = 'https://13.49.221.111';
    let userId = null;
    let selectedAccountType = null;

    // Professional Status Configuration
    const professionalStatusConfig = {
        'student': {
            background: {
                label: 'Student Background',
                options: [
                    { value: 'basic-education', label: 'Basic Education' },
                    { value: 'secondary-education', label: 'Secondary Education' },
                    { value: 'tertiary-education', label: 'Tertiary Education' },
                    { value: 'others', label: 'Others' }
                ]
            },
            interest: {
                label: 'Interest',
                options: [
                    { value: 'arts', label: 'Arts' },
                    { value: 'sciences', label: 'Sciences' },
                    { value: 'social-sciences', label: 'Social Sciences' },
                    { value: 'engineering', label: 'Engineering' },
                    { value: 'others', label: 'Others' }
                ]
            }
        },
        'unemployed': {
            background: {
                label: 'Unemployment Background',
                options: [
                    { value: 'able-willing-work', label: 'Able and willing to work' },
                    { value: 'disabled-willing-work', label: 'Disabled but willing to work' },
                    { value: 'disabled-cannot-work', label: 'Disabled and cannot work' },
                    { value: 'others', label: 'Others' }
                ]
            },
            interest: {
                label: 'Interest',
                options: [
                    { value: 'career-development', label: 'Job (Career Development)' },
                    { value: 'skill-building', label: 'Skill Building' },
                    { value: 'business-entrepreneurship', label: 'Business / Entrepreneurship' },
                    { value: 'others', label: 'Others' }
                ]
            }
        },
        'employed': {
            background: {
                label: 'Employment Background',
                options: [
                    { value: 'professional-white-collar', label: 'Professional/White-Collar Jobs' },
                    { value: 'skilled-trades-blue-collar', label: 'Skilled Trades/Blue-Collar Jobs' },
                    { value: 'service-industry', label: 'Service Industry Jobs' },
                    { value: 'healthcare', label: 'Healthcare Jobs' },
                    { value: 'others', label: 'Others' }
                ]
            },
            interest: {
                label: 'Interest',
                options: [
                    { value: 'career-advancement', label: 'Career Advancement' },
                    { value: 'skill-enhancement', label: 'Skill Enhancement' },
                    { value: 'work-life-balance', label: 'Work-Life Balance' },
                    { value: 'financial-growth', label: 'Financial Growth' },
                    { value: 'others', label: 'Others' }
                ]
            }
        },
        'self-employed': {
            background: {
                label: 'Self-Employed Background',
                options: [
                    { value: 'skilled-trades-services', label: 'Skilled Trades & Services' },
                    { value: 'freelancing-remote-work', label: 'Freelancing & Remote Work' },
                    { value: 'retail-sales', label: 'Retail & Sales' },
                    { value: 'agriculture-farming', label: 'Agriculture & Farming' },
                    { value: 'others', label: 'Others' }
                ]
            },
            interest: {
                label: 'Interest',
                options: [
                    { value: 'business-growth-scaling', label: 'Business Growth & Scaling' },
                    { value: 'financial-management', label: 'Financial Management' },
                    { value: 'skill-development', label: 'Skill Development' },
                    { value: 'marketing-branding', label: 'Marketing & Branding' },
                    { value: 'others', label: 'Others' }
                ]
            }
        },
        'retired': {
            background: {
                label: 'Retirement Background',
                options: [
                    { value: 'voluntary-retirement', label: 'Voluntary Retirement' },
                    { value: 'health-retirement', label: 'Health-related Retirement' },
                    { value: 'mandatory-retirement', label: 'Mandatory Retirement Age' },
                    { value: 'others', label: 'Others' }
                ]
            },
            interest: {
                label: 'Interest',
                options: [
                    { value: 'hobbies-leisure', label: 'Hobbies & Leisure' },
                    { value: 'volunteering', label: 'Volunteering' },
                    { value: 'part-time-work', label: 'Part-time Work' },
                    { value: 'health-wellness', label: 'Health & Wellness' },
                    { value: 'others', label: 'Others' }
                ]
            }
        }
    };

    document.addEventListener('DOMContentLoaded', function() {
        const parts = document.querySelectorAll('.form-part');
        let currentPart = 0;

        function showPart(index) {
            parts.forEach((part, i) => {
                part.classList.toggle('active', i === index);
                part.classList.toggle('left', i < index);
                part.classList.toggle('right', i > index);
            });
        }

        // Step 1: Create User Account
        document.getElementById('nextBtn').addEventListener('click', async function() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const otherName = document.getElementById('otherName').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const phone = document.getElementById('phone').value.trim();
            const sex = document.getElementById('sex').value;
            const country = document.getElementById('country').value;
            const state = document.getElementById('state').value;
            const terms = document.getElementById('termsCheckbox').checked;
            const errorEl = document.getElementById('part1Error');

            errorEl.textContent = '';

            // Validation
            if (!firstName || !lastName || !email || !password || !confirmPassword || !phone || !sex || !country || !state) {
                errorEl.textContent = 'Please fill in all required fields';
                return;
            }

            if (password !== confirmPassword) {
                errorEl.textContent = 'Passwords do not match';
                return;
            }

            if (password.length < 8) {
                errorEl.textContent = 'Password must be at least 8 characters';
                return;
            }

            if (!terms) {
                errorEl.textContent = 'Please accept the terms and conditions';
                return;
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorEl.textContent = 'Please enter a valid email address';
                return;
            }

            // Phone validation (basic)
            if (phone.length < 10) {
                errorEl.textContent = 'Please enter a valid phone number';
                return;
            }

            // Show loading
            this.disabled = true;
            document.getElementById('nextSpinner').style.display = 'inline-block';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/signup`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        firstName,
                        lastName,
                        otherName,
                        email,
                        password,
                        phoneNumber: phone,
                        sex,
                        country,
                        state_province: state,
                        account_type: 'pending' // Will be set in next step
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || data.error || 'Failed to create account');
                }

                userId = data.userId;
                currentPart = 1;
                showPart(currentPart);

            } catch (error) {
                errorEl.textContent = error.message || 'An error occurred. Please try again.';
            } finally {
                this.disabled = false;
                document.getElementById('nextSpinner').style.display = 'none';
            }
        });

        // Account Type Selection
        document.querySelectorAll('.account-type-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.account-type-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                selectedAccountType = this.dataset.type;

                setTimeout(() => {
                    if (selectedAccountType === 'corporate') {
                        currentPart = 2;
                    } else {
                        currentPart = 3;
                    }
                    showPart(currentPart);
                }, 300);
            });
        });

        // Back buttons
        document.getElementById('backToStep1').addEventListener('click', () => {
            currentPart = 0;
            showPart(currentPart);
        });

        document.getElementById('backToStep2Corporate').addEventListener('click', () => {
            currentPart = 1;
            showPart(currentPart);
        });

        document.getElementById('backToStep2Individual').addEventListener('click', () => {
            currentPart = 1;
            showPart(currentPart);
        });

        // Corporate Account Type Change Handler
        document.getElementById('corporateAccountType').addEventListener('change', function() {
            const otherInput = document.getElementById('otherCorporateAccountTypeInput');
            if (this.value === 'others') {
                otherInput.style.display = 'block';
                otherInput.required = true;
            } else {
                otherInput.style.display = 'none';
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Organization Select Handler
        document.getElementById('organizationSelect').addEventListener('change', function() {
            const otherInput = document.getElementById('otherOrganizationInput');
            if (this.value === 'others') {
                otherInput.style.display = 'block';
                otherInput.required = true;
            } else {
                otherInput.style.display = 'none';
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Sector Select Handler
        document.getElementById('privateSectorSelect').addEventListener('change', function() {
            const otherInput = document.getElementById('otherPrivateSectorInput');
            if (this.value === 'others') {
                otherInput.style.display = 'block';
                otherInput.required = true;
            } else {
                otherInput.style.display = 'none';
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Confirm Corporate Account
        document.getElementById('confirmCorporateAccountBtn').addEventListener('click', async function() {
            const accountType = document.getElementById('corporateAccountType').value;
            const accountTypeOther = document.getElementById('otherCorporateAccountTypeInput').value.trim();
            const organization = document.getElementById('organizationSelect').value;
            const organizationOther = document.getElementById('otherOrganizationInput').value.trim();
            const sector = document.getElementById('privateSectorSelect').value;
            const sectorOther = document.getElementById('otherPrivateSectorInput').value.trim();
            const errorEl = document.getElementById('part3Error');
            const successEl = document.getElementById('part3Success');

            errorEl.textContent = '';
            successEl.textContent = '';

            // Validation
            if (!accountType || !organization || !sector) {
                errorEl.textContent = 'Please fill in all required fields';
                return;
            }

            if (accountType === 'others' && !accountTypeOther) {
                errorEl.textContent = 'Please specify your corporate account type';
                return;
            }

            if (organization === 'others' && !organizationOther) {
                errorEl.textContent = 'Please specify your organization';
                return;
            }

            if (sector === 'others' && !sectorOther) {
                errorEl.textContent = 'Please specify your sector';
                return;
            }

            if (!userId) {
                errorEl.textContent = 'Session expired. Please start over.';
                return;
            }

            // Show loading
            this.disabled = true;
            document.getElementById('corporateSpinner').style.display = 'inline-block';

            try {
                const finalAccountType = accountType === 'others' ? accountTypeOther : accountType;
                const finalOrganization = organization === 'others' ? organizationOther : organization;
                const finalSector = sector === 'others' ? sectorOther : sector;

                const response = await fetch(`${API_BASE_URL}/account/create-corporate-account`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        account_type: finalAccountType,
                        organization: finalOrganization,
                        sector: finalSector,
                        userId: userId
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || data.error || 'Failed to create corporate account');
                }

                successEl.textContent = 'Account created successfully! Redirecting...';
                
                setTimeout(() => {
                    window.location.href = 'loading.html';
                }, 1500);

            } catch (error) {
                errorEl.textContent = error.message || 'An error occurred. Please try again.';
            } finally {
                this.disabled = false;
                document.getElementById('corporateSpinner').style.display = 'none';
            }
        });

        // Professional Status Change Handler
        document.getElementById('professionalStatus').addEventListener('change', function() {
            const status = this.value;
            const otherInput = document.getElementById('otherProfessionalStatusInput');
            const backgroundGroup = document.getElementById('backgroundGroup');
            const interestGroup = document.getElementById('interestGroup');
            const backgroundSelect = document.getElementById('backgroundSelect');
            const interestSelect = document.getElementById('interestSelect');
            const backgroundLabel = document.getElementById('backgroundLabel');
            const interestLabel = document.getElementById('interestLabel');

            // Handle "Others" input
            if (status === 'others') {
                otherInput.style.display = 'block';
                otherInput.required = true;
                backgroundGroup.style.display = 'none';
                interestGroup.style.display = 'none';
                backgroundSelect.required = false;
                interestSelect.required = false;
            } else {
                otherInput.style.display = 'none';
                otherInput.required = false;
                otherInput.value = '';

                // Update background and interest fields
                const config = professionalStatusConfig[status];
                if (config) {
                    // Update labels
                    backgroundLabel.textContent = config.background.label;
                    interestLabel.textContent = config.interest.label;

                    // Clear and populate background options
                    backgroundSelect.innerHTML = '<option value="" disabled selected>Select background</option>';
                    config.background.options.forEach(option => {
                        const opt = new Option(option.label, option.value);
                        backgroundSelect.add(opt);
                    });

                    // Clear and populate interest options
                    interestSelect.innerHTML = '<option value="" disabled selected>Select interest</option>';
                    config.interest.options.forEach(option => {
                        const opt = new Option(option.label, option.value);
                        interestSelect.add(opt);
                    });

                    // Show groups
                    backgroundGroup.style.display = 'block';
                    interestGroup.style.display = 'block';
                    backgroundSelect.required = true;
                    interestSelect.required = true;

                    // Hide "Others" inputs
                    document.getElementById('otherBackgroundInput').style.display = 'none';
                    document.getElementById('otherInterestInput').style.display = 'none';
                }
            }
        });

        // Background Select Handler
        document.getElementById('backgroundSelect').addEventListener('change', function() {
            const otherInput = document.getElementById('otherBackgroundInput');
            if (this.value === 'others') {
                otherInput.style.display = 'block';
                otherInput.required = true;
            } else {
                otherInput.style.display = 'none';
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Interest Select Handler
        document.getElementById('interestSelect').addEventListener('change', function() {
            const otherInput = document.getElementById('otherInterestInput');
            if (this.value === 'others') {
                otherInput.style.display = 'block';
                otherInput.required = true;
            } else {
                otherInput.style.display = 'none';
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Confirm Individual Account
        document.getElementById('confirmIndividualAccountBtn').addEventListener('click', async function() {
            const status = document.getElementById('professionalStatus').value;
            const statusOther = document.getElementById('otherProfessionalStatusInput').value.trim();
            const background = document.getElementById('backgroundSelect').value;
            const backgroundOther = document.getElementById('otherBackgroundInput').value.trim();
            const interest = document.getElementById('interestSelect').value;
            const interestOther = document.getElementById('otherInterestInput').value.trim();
            const errorEl = document.getElementById('part4Error');
            const successEl = document.getElementById('part4Success');

            errorEl.textContent = '';
            successEl.textContent = '';

            // Validation
            if (!status) {
                errorEl.textContent = 'Please select your professional status';
                return;
            }

            if (status === 'others') {
                if (!statusOther) {
                    errorEl.textContent = 'Please specify your professional status';
                    return;
                }
            } else {
                if (!background || !interest) {
                    errorEl.textContent = 'Please fill in all required fields';
                    return;
                }

                if (background === 'others' && !backgroundOther) {
                    errorEl.textContent = 'Please specify your background';
                    return;
                }

                if (interest === 'others' && !interestOther) {
                    errorEl.textContent = 'Please specify your interest';
                    return;
                }
            }

            if (!userId) {
                errorEl.textContent = 'Session expired. Please start over.';
                return;
            }

            // Show loading
            this.disabled = true;
            document.getElementById('individualSpinner').style.display = 'inline-block';

            try {
                const finalStatus = status === 'others' ? statusOther : status;
                const finalBackground = background === 'others' ? backgroundOther : background;
                const finalInterest = interest === 'others' ? interestOther : interest;

                const response = await fetch(`${API_BASE_URL}/account/create-individual-account`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        status_title: finalStatus,
                        status_background: finalBackground || '',
                        interests: [finalInterest || ''],
                        userId: userId
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || data.error || 'Failed to create individual account');
                }

                successEl.textContent = 'Account created successfully! Redirecting...';
                
                setTimeout(() => {
                    window.location.href = 'loading.html';
                }, 1500);

            } catch (error) {
                errorEl.textContent = error.message || 'An error occurred. Please try again.';
            } finally {
                this.disabled = false;
                document.getElementById('individualSpinner').style.display = 'none';
            }
        });

        // Initialize
        showPart(currentPart);
    });
</script>
</body>
</html>